import{m as u,b as o,w as t,E as T,c as g,v as h,ae as F,F as p,l as U,o as s,H as J,q as b,ah as E,e as m,g as k,p as v,M as I,P as K,u as $,t as _,O as w,J as S,Q as N,I as D,h as j,ap as M,y as P,f as L,n as W,j as A,K as z}from"./index-809c946b.js";import{A as C}from"./AstrBotConfig-b6194601.js";import{W as q}from"./WaitingForRestart-f77d905b.js";import{V as B}from"./index-313075e3.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./common-a3b3ada7.js";const X={key:2,style:{"margin-left":"16px"}},G=b("span",{style:{"font-weight":"1000"}},"再",-1),R={key:0,style:{border:"1px solid #e0e0e0",padding:"8px","margin-bottom":"16px","border-radius":"10px"}},H={style:{padding:"16px"}},Q={key:1},Y={key:0,style:{border:"1px solid #e0e0e0",padding:"8px","margin-bottom":"16px","border-radius":"10px"}},Z=b("div",{style:{"margin-left":"16px","padding-bottom":"16px"}},[b("small",null,[m("不了解配置？请见 "),b("a",{href:"https://astrbot.app/"},"官方文档"),m(" 或 "),b("a",{href:"https://qm.qq.com/cgi-bin/qm/qr?k=EYGsuUTfe00_iOu9JTXS7_TEpMkXOvwv&jump_from=webapi&authKey=uUEMKCROfsseS+8IzqPjzV3y1tzy4AkykwTib2jNkOFdzezF9s9XknqnIaf3CDft"},"加群询问"),m("。")])],-1),x={name:"ConfigPage",components:{AstrBotConfig:C,VueMonacoEditor:B,WaitingForRestart:q},watch:{config_data_str:function(l){this.config_data_has_changed=!0}},data(){return{config_data_has_changed:!1,config_data_str:"",config_data:{config:{}},fetched:!1,metadata:{},provider_config_tmpl:{},adapter_config_tmpl:{},save_message_snack:!1,save_message:"",save_message_success:"",namespace:"",tab:0,editorTab:0,config_template_tab:0}},mounted(){this.getConfig()},methods:{getConfig(){U.get("/api/config/get").then(l=>{this.config_data=l.data.data.config,this.fetched=!0,this.metadata=l.data.data.metadata,this.provider_config_tmpl=l.data.data.provider_config_tmpl,this.adapter_config_tmpl=l.data.data.adapter_config_tmpl}).catch(l=>{save_message=l,save_message_snack=!0,save_message_success="error"})},updateConfig(){this.fetched&&U.post("/api/config/astrbot/update",this.config_data).then(l=>{l.data.status==="ok"?(this.save_message=l.data.message,this.save_message_snack=!0,this.save_message_success="success",this.$refs.wfr.check()):(this.save_message=l.data.message,this.save_message_snack=!0,this.save_message_success="error")}).catch(l=>{this.save_message=l,this.save_message_snack=!0,this.save_message_success="error"})},configToString(){this.config_data_str=JSON.stringify(this.config_data,null,2),this.config_data_has_changed=!1},applyStrConfig(){try{this.config_data=JSON.parse(this.config_data_str),this.config_data_has_changed=!1,this.save_message_success="success",this.save_message="配置成功应用。如要保存，需再点击右下角保存按钮。",this.save_message_snack=!0}catch{this.save_message_success="error",this.save_message="配置未应用，Json 格式错误。",this.save_message_snack=!0}},addFromDefaultConfigTmpl(l,a,e){console.log(l);let i=this.metadata[a].metadata[e].config_template[l],r=JSON.parse(JSON.stringify(i));this.config_data[e].push(r),this.config_template_tab=this.config_data[e].length-1},deleteItem(l,a){console.log(l,a);let e=[];for(let i=0;i<this.config_data[l].length;i++)i!==a&&e.push(this.config_data[l][i]);this.config_data[l]=e,this.config_template_tab>0&&(this.config_template_tab-=1)}}},na=Object.assign(x,{setup(l){return(a,e)=>(s(),u(p,null,[o(T,{style:{"margin-bottom":"16px"}},{default:t(()=>[o(J,{style:{padding:"0"}},{default:t(()=>[b("div",null,[o(E,{variant:"outlined",divided:""},{default:t(()=>[o(h,{icon:"mdi-text-box-edit-outline",style:{width:"80px"},color:a.editorTab===0?"primary":"",onClick:e[0]||(e[0]=i=>a.editorTab=0)},null,8,["color"]),o(h,{icon:"mdi-code-json",style:{width:"80px"},color:a.editorTab===1?"primary":"",onClick:e[1]||(e[1]=i=>{a.configToString(),a.editorTab=1})},null,8,["color"])]),_:1}),a.editorTab===1?(s(),g(h,{key:0,style:{"margin-left":"16px"},size:"small",onClick:e[2]||(e[2]=i=>a.configToString())},{default:t(()=>[m("回到更改前的代码")]),_:1})):k("",!0),a.editorTab===1&&a.config_data_has_changed?(s(),g(h,{key:1,style:{"margin-left":"16px"},size:"small",onClick:e[3]||(e[3]=i=>a.applyStrConfig())},{default:t(()=>[m("应用此配置")]),_:1})):k("",!0),a.editorTab===1?(s(),u("small",X,[m("💡 `应用此配置` 将配置暂存并应用到可视化。如要保存，需"),G,m("点击右下角保存按钮。")])):k("",!0)])]),_:1})]),_:1}),a.editorTab===0?(s(),g(T,{key:0},{default:t(()=>[o(I,{modelValue:a.tab,"onUpdate:modelValue":e[4]||(e[4]=i=>a.tab=i),"align-tabs":"left",color:"deep-purple-accent-4"},{default:t(()=>[(s(!0),u(p,null,v(a.metadata,(i,r,y)=>(s(),g(w,{key:y,value:y,style:{"font-weight":"1000","font-size":"15px"}},{default:t(()=>[m(_(a.metadata[r].name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),o(K,{modelValue:a.tab,"onUpdate:modelValue":e[7]||(e[7]=i=>a.tab=i)},{default:t(()=>[(s(!0),u(p,null,v(a.metadata,(i,r,y)=>S((s(),g(N,{key:y},{default:t(()=>[o(D,{fluid:""},{default:t(()=>[(s(!0),u(p,null,v(a.metadata[r].metadata,(aa,d,ea)=>{var O;return s(),u("div",null,[(O=a.metadata[r].metadata[d])!=null&&O.config_template?S((s(),u("div",R,[o(j,{style:{"font-weight":"bold"}},{default:t(()=>[m(_(a.metadata[r].metadata[d].description)+" ("+_(d)+") ",1)]),_:2},1024),o(I,{style:{"margin-top":"16px"},"align-tabs":"left",color:"deep-purple-accent-4",modelValue:a.config_template_tab,"onUpdate:modelValue":e[5]||(e[5]=f=>a.config_template_tab=f)},{default:t(()=>{var f;return[(f=a.metadata[r].metadata[d])!=null&&f.tmpl_display_title?(s(!0),u(p,{key:0},v(a.config_data[d],(n,c)=>(s(),g(w,{key:c,value:c},{default:t(()=>{var V;return[m(_(n[(V=a.metadata[r].metadata[d])==null?void 0:V.tmpl_display_title]),1)]}),_:2},1032,["value"]))),128)):(s(!0),u(p,{key:1},v(a.config_data[d],(n,c)=>(s(),g(w,{key:c+"_",value:c},{default:t(()=>[m(_(n.id)+"("+_(n.type)+") ",1)]),_:2},1032,["value"]))),128)),o(M,null,{activator:t(({props:n})=>[o(h,P({variant:"plain",size:"large"},n),{default:t(()=>[o(L,null,{default:t(()=>[m("mdi-plus")]),_:1})]),_:2},1040)]),default:t(()=>[o(W,{"onUpdate:selected":n=>a.addFromDefaultConfigTmpl(n,r,d)},{default:t(()=>{var n;return[(s(!0),u(p,null,v((n=a.metadata[r].metadata[d])==null?void 0:n.config_template,(c,V)=>(s(),g(A,{key:V,value:V},{default:t(()=>[o(j,null,{default:t(()=>[m(_(V),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]}),_:2},1032,["onUpdate:selected"])]),_:2},1024)]}),_:2},1032,["modelValue"]),o(K,{modelValue:a.config_template_tab,"onUpdate:modelValue":e[6]||(e[6]=f=>a.config_template_tab=f)},{default:t(()=>[(s(!0),u(p,null,v(a.config_data[d],(f,n)=>S((s(),g(N,{key:n,value:n},{default:t(()=>[b("div",H,[o(h,{variant:"tonal",rounded:"xl",color:"error",onClick:c=>a.deleteItem(d,n)},{default:t(()=>[m(" 删除这项 ")]),_:2},1032,["onClick"]),o(C,{metadata:a.metadata[r].metadata,iterable:f,metadataKey:d},null,8,["metadata","iterable","metadataKey"])])]),_:2},1032,["value"])),[[z,a.config_template_tab===n]])),128))]),_:2},1032,["modelValue"])],512)),[[z,d!=="platform"&&d!=="provider"]]):(s(),u("div",Q,[a.metadata[r].metadata[d].type=="object"?(s(),u("div",Y,[o(C,{metadata:a.metadata[r].metadata,iterable:a.config_data[d],metadataKey:d},null,8,["metadata","iterable","metadataKey"])])):(s(),g(C,{key:1,metadata:a.metadata[r].metadata,iterable:a.config_data,metadataKey:d},null,8,["metadata","iterable","metadataKey"]))]))])}),256))]),_:2},1024)]),_:2},1024)),[[z,y==a.tab]])),128)),Z]),_:1},8,["modelValue"])]),_:1})):(s(),g(T,{key:1,style:{"background-color":"#1e1e1e"}},{default:t(()=>[o($(B),{theme:"vs-dark",language:"json",height:"80vh",style:{"padding-top":"16px","padding-bottom":"16px"},value:a.config_data_str,"onUpdate:value":e[8]||(e[8]=i=>a.config_data_str=i)},null,8,["value"])]),_:1})),o(h,{icon:"mdi-content-save",size:"x-large",style:{position:"fixed",right:"52px",bottom:"52px"},color:"darkprimary",onClick:a.updateConfig},null,8,["onClick"]),o(F,{timeout:3e3,elevation:"24",color:a.save_message_success,modelValue:a.save_message_snack,"onUpdate:modelValue":e[9]||(e[9]=i=>a.save_message_snack=i)},{default:t(()=>[m(_(a.save_message),1)]),_:1},8,["color","modelValue"]),o(q,{ref:"wfr"},null,512)],64))}});export{na as default};
