import{l as u,a7 as w,m as y,b as e,w as t,I as B,W as M,ae as F,o as h,X as z,Y as W,q as p,f as _,e as n,E as V,G as S,V as N,t as f,D as k,ap as j,v as x,y as L,n as O,F as R,p as U,T as E,H as A,g as I,au as G,c as T,U as J,j as K,h as q,a5 as H,a6 as X}from"./index-809c946b.js";import{A as Y}from"./AstrBotConfig-b6194601.js";import{W as Q}from"./WaitingForRestart-f77d905b.js";import{C as Z}from"./ConsoleDisplayer-6264eb94.js";import{I as $}from"./ItemCardGrid-13ec4bfa.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import"./common-a3b3ada7.js";const se={name:"ProviderPage",components:{AstrBotConfig:Y,WaitingForRestart:Q,ConsoleDisplayer:Z,ItemCardGrid:$},data(){return{config_data:{},fetched:!1,metadata:{},showProviderCfg:!1,newSelectedProviderName:"",newSelectedProviderConfig:{},updatingMode:!1,loading:!1,save_message_snack:!1,save_message:"",save_message_success:"success",showConsole:!1}},mounted(){this.getConfig()},methods:{getConfig(){u.get("/api/config/get").then(s=>{this.config_data=s.data.data.config,this.fetched=!0,this.metadata=s.data.data.metadata}).catch(s=>{var a,d;this.showError(((d=(a=s.response)==null?void 0:a.data)==null?void 0:d.message)||s.message)})},addFromDefaultConfigTmpl(s){var a,d,c;this.newSelectedProviderName=s[0],this.showProviderCfg=!0,this.updatingMode=!1,this.newSelectedProviderConfig=JSON.parse(JSON.stringify(((c=(d=(a=this.metadata.provider_group)==null?void 0:a.metadata)==null?void 0:d.provider)==null?void 0:c.config_template[s[0]])||{}))},configExistingProvider(s){var i,g,v,C;this.newSelectedProviderName=s.id,this.newSelectedProviderConfig={};let a=((v=(g=(i=this.metadata.provider_group)==null?void 0:i.metadata)==null?void 0:g.provider)==null?void 0:v.config_template)||{},d={};for(let m in a)if(((C=a[m])==null?void 0:C.type)===s.type){d=a[m];break}const c=(m,r,o)=>{if(r&&typeof r=="object"&&!Array.isArray(r))for(let l in r)r.hasOwnProperty(l)&&(typeof r[l]=="object"&&r[l]!==null?m[l]=Array.isArray(r[l])?[...r[l]]:{...r[l]}:m[l]=r[l]);for(let l in o)typeof o[l]=="object"&&o[l]!==null?(l in m||(m[l]=Array.isArray(o[l])?[]:{}),c(m[l],r&&r[l]?r[l]:{},o[l])):l in m||(m[l]=o[l])};d&&c(this.newSelectedProviderConfig,s,d),this.showProviderCfg=!0,this.updatingMode=!0},newProvider(){this.loading=!0,this.updatingMode?(u.post("/api/config/provider/update",{id:this.newSelectedProviderName,config:this.newSelectedProviderConfig}).then(s=>{this.loading=!1,this.showProviderCfg=!1,this.getConfig(),this.showSuccess(s.data.message||"更新成功!")}).catch(s=>{var a,d;this.loading=!1,this.showError(((d=(a=s.response)==null?void 0:a.data)==null?void 0:d.message)||s.message)}),this.updatingMode=!1):u.post("/api/config/provider/new",this.newSelectedProviderConfig).then(s=>{this.loading=!1,this.showProviderCfg=!1,this.getConfig(),this.showSuccess(s.data.message||"添加成功!")}).catch(s=>{var a,d;this.loading=!1,this.showError(((d=(a=s.response)==null?void 0:a.data)==null?void 0:d.message)||s.message)})},deleteProvider(s){confirm(`确定要删除服务提供商 ${s.id} 吗?`)&&u.post("/api/config/provider/delete",{id:s.id}).then(a=>{this.getConfig(),this.showSuccess(a.data.message||"删除成功!")}).catch(a=>{var d,c;this.showError(((c=(d=a.response)==null?void 0:d.data)==null?void 0:c.message)||a.message)})},providerStatusChange(s){s.enable=!s.enable,u.post("/api/config/provider/update",{id:s.id,config:s}).then(a=>{this.getConfig(),this.showSuccess(a.data.message||"状态更新成功!")}).catch(a=>{var d,c;s.enable=!s.enable,this.showError(((c=(d=a.response)==null?void 0:d.data)==null?void 0:c.message)||a.message)})},showSuccess(s){this.save_message=s,this.save_message_success="success",this.save_message_snack=!0},showError(s){this.save_message=s,this.save_message_success="error",this.save_message_snack=!0}}},P=s=>(H("data-v-6d7fe766"),s=s(),X(),s),ae={class:"provider-page"},te={class:"text-h4 font-weight-bold mb-2"},oe=P(()=>p("p",{class:"text-subtitle-1 text-medium-emphasis mb-4"}," 管理AI服务提供商，连接到不同的大语言模型 ",-1)),ie=P(()=>p("span",{class:"text-h6"},"服务提供商",-1)),le={class:"d-flex align-center mb-2"},de={class:"text-caption text-medium-emphasis"},ne={key:0,class:"d-flex align-center mb-2"},re=["title"],ce={key:1,class:"d-flex align-center"},me=P(()=>p("span",{class:"text-caption text-medium-emphasis"},"API Key: ••••••••",-1)),fe=P(()=>p("span",{class:"text-h6"},"服务日志",-1));function pe(s,a,d,c,i,g){const v=w("item-card-grid"),C=w("ConsoleDisplayer"),m=w("AstrBotConfig"),r=w("WaitingForRestart");return h(),y("div",ae,[e(B,{fluid:"",class:"pa-0"},{default:t(()=>[e(z,null,{default:t(()=>[e(W,{cols:"12"},{default:t(()=>[p("h1",te,[e(_,{size:"x-large",color:"primary",class:"me-2"},{default:t(()=>[n("mdi-creation")]),_:1}),n("服务提供商管理 ")]),oe]),_:1})]),_:1}),e(V,{class:"mb-6",elevation:"2"},{default:t(()=>[e(S,{class:"d-flex align-center py-3 px-4"},{default:t(()=>[e(_,{color:"primary",class:"me-2"},{default:t(()=>[n("mdi-api")]),_:1}),ie,e(N,{color:"info",size:"small",class:"ml-2"},{default:t(()=>{var o;return[n(f(((o=i.config_data.provider)==null?void 0:o.length)||0),1)]}),_:1}),e(k),e(j,null,{activator:t(({props:o})=>[e(x,L({color:"primary","prepend-icon":"mdi-plus",variant:"tonal"},o),{default:t(()=>[n(" 新增服务提供商 ")]),_:2},1040)]),default:t(()=>[e(O,{"onUpdate:selected":a[0]||(a[0]=o=>g.addFromDefaultConfigTmpl(o))},{default:t(()=>{var o,l,D;return[(h(!0),y(R,null,U(((D=(l=(o=i.metadata.provider_group)==null?void 0:o.metadata)==null?void 0:l.provider)==null?void 0:D.config_template)||{},(ge,b)=>(h(),T(K,{key:b,rounded:"xl",value:b},{default:t(()=>[e(q,null,{default:t(()=>[n(f(b),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]}),_:1})]),_:1})]),_:1}),e(E),e(A,{class:"px-4 py-3"},{default:t(()=>[e(v,{items:i.config_data.provider||[],"title-field":"id","enabled-field":"enable","empty-icon":"mdi-api-off","empty-text":"暂无服务提供商，点击 新增服务提供商 添加",onToggleEnabled:g.providerStatusChange,onDelete:g.deleteProvider,onEdit:g.configExistingProvider},{"item-details":t(({item:o})=>[p("div",le,[e(_,{size:"small",color:"grey",class:"me-2"},{default:t(()=>[n("mdi-tag")]),_:1}),p("span",de,[n(" 提供商类型: "),e(N,{size:"x-small",color:"primary",class:"ml-1"},{default:t(()=>[n(f(o.type),1)]),_:2},1024)])]),o.api_base?(h(),y("div",ne,[e(_,{size:"small",color:"grey",class:"me-2"},{default:t(()=>[n("mdi-web")]),_:1}),p("span",{class:"text-caption text-medium-emphasis text-truncate",title:o.api_base}," API Base: "+f(o.api_base),9,re)])):I("",!0),o.api_key?(h(),y("div",ce,[e(_,{size:"small",color:"grey",class:"me-2"},{default:t(()=>[n("mdi-key")]),_:1}),me])):I("",!0)]),_:1},8,["items","onToggleEnabled","onDelete","onEdit"])]),_:1})]),_:1}),e(V,{elevation:"2"},{default:t(()=>[e(S,{class:"d-flex align-center py-3 px-4"},{default:t(()=>[e(_,{color:"primary",class:"me-2"},{default:t(()=>[n("mdi-console-line")]),_:1}),fe,e(k),e(x,{variant:"text",color:"primary",onClick:a[1]||(a[1]=o=>i.showConsole=!i.showConsole)},{default:t(()=>[n(f(i.showConsole?"收起":"展开")+" ",1),e(_,null,{default:t(()=>[n(f(i.showConsole?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:1})]),_:1})]),_:1}),e(E),e(G,null,{default:t(()=>[i.showConsole?(h(),T(A,{key:0,class:"pa-0"},{default:t(()=>[e(C,{style:{"background-color":"#1e1e1e",height:"300px","border-radius":"0"}})]),_:1})):I("",!0)]),_:1})]),_:1})]),_:1}),e(M,{modelValue:i.showProviderCfg,"onUpdate:modelValue":a[3]||(a[3]=o=>i.showProviderCfg=o),width:"900",persistent:""},{default:t(()=>[e(V,null,{default:t(()=>[e(S,{class:"bg-primary text-white py-3"},{default:t(()=>[e(_,{color:"white",class:"me-2"},{default:t(()=>[n(f(i.updatingMode?"mdi-pencil":"mdi-plus"),1)]),_:1}),p("span",null,f(i.updatingMode?"编辑":"新增")+" "+f(i.newSelectedProviderName)+" 服务提供商",1)]),_:1}),e(A,{class:"py-4"},{default:t(()=>{var o;return[e(m,{iterable:i.newSelectedProviderConfig,metadata:(o=i.metadata.provider_group)==null?void 0:o.metadata,metadataKey:"provider"},null,8,["iterable","metadata"])]}),_:1}),e(E),e(J,{class:"pa-4"},{default:t(()=>[e(k),e(x,{variant:"text",onClick:a[2]||(a[2]=o=>i.showProviderCfg=!1),disabled:i.loading},{default:t(()=>[n(" 取消 ")]),_:1},8,["disabled"]),e(x,{color:"primary",onClick:g.newProvider,loading:i.loading},{default:t(()=>[n(" 保存 ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(F,{timeout:3e3,elevation:"24",color:i.save_message_success,modelValue:i.save_message_snack,"onUpdate:modelValue":a[4]||(a[4]=o=>i.save_message_snack=o),location:"top"},{default:t(()=>[n(f(i.save_message),1)]),_:1},8,["color","modelValue"]),e(r,{ref:"wfr"},null,512)])}const xe=ee(se,[["render",pe],["__scopeId","data-v-6d7fe766"]]);export{xe as default};
