import{l as V,a7 as L,m as p,b as e,w as t,I as X,W as j,ae as Q,o as n,X as z,Y as D,q as l,f as m,e as i,x as J,y as O,M as Z,O as B,aw as $,ax as F,E as b,G as M,D as x,v as g,T as P,H as C,t as c,ay as A,F as y,p as w,V as E,au as ee,c as v,S as U,az as q,g as T,a9 as te,aA as se,aB as le,B as G,aC as ae,U as I,aD as K,aE as W,aF as Y,an as H,a5 as oe,a6 as re}from"./index-809c946b.js";import{A as ie}from"./AstrBotConfig-b6194601.js";import{V as ne}from"./index-313075e3.js";import{I as ce}from"./ItemCardGrid-13ec4bfa.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";const me={name:"ToolUsePage",components:{AstrBotConfig:ie,VueMonacoEditor:ne,ItemCardGrid:ce},data(){return{refreshInterval:null,activeTab:"local",mcpServers:[],tools:[],showMcpServerDialog:!1,showServerDetailDialog:!1,showTools:!0,loading:!1,isEditMode:!1,serverConfigJson:"",jsonError:null,currentServer:{name:"",active:!0,tools:[]},save_message_snack:!1,save_message:"",save_message_success:"success",toolSearch:"",openedPanel:[],marketplaceServers:[],marketplaceLoading:!1,marketplaceSearch:"",selectedMarketplaceServer:null,selectedServerConfigDisplay:"",currentMarketPage:1,marketPageSize:9,totalMarketPages:1,totalMarketItems:0}},computed:{filteredTools(){if(!this.toolSearch)return this.tools;const o=this.toolSearch.toLowerCase();return this.tools.filter(s=>s.function.name.toLowerCase().includes(o)||s.function.description.toLowerCase().includes(o))},isServerFormValid(){return!!this.currentServer.name&&!this.jsonError},getServerConfigSummary(){return o=>{if(o.command)return`${o.command} ${(o.args||[]).join(" ")}`;const s=Object.keys(o).filter(u=>!["name","active","tools"].includes(u));return s.length>0?`配置: ${s.join(", ")}`:"未设置配置"}},filteredMarketplaceServers(){return this.marketplaceServers}},mounted(){this.getServers(),this.getTools(),this.fetchMarketplaceServers(),this.refreshInterval=setInterval(()=>{this.getServers(),this.getTools()},5e3)},unmounted(){this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{openurl(o){window.open(o,"_blank")},formatToolName(o){if(o.includes(":")){const s=o.split(":");return s[s.length-1]}return o},getServers(){this.loading=!0,V.get("/api/tools/mcp/servers").then(o=>{this.mcpServers=o.data.data||[]}).catch(o=>{this.showError("获取 MCP 服务器列表失败: "+o.message)}).finally(()=>{setTimeout(()=>{this.loading=!1},500)})},getTools(){V.get("/api/config/llmtools").then(o=>{this.tools=o.data.data||[]}).catch(o=>{this.showError("获取函数工具列表失败: "+o.message)})},validateJson(){try{return this.serverConfigJson.trim()?(JSON.parse(this.serverConfigJson),this.jsonError=null,!0):(this.jsonError="配置不能为空",!1)}catch(o){return this.jsonError=`JSON 格式错误: ${o.message}`,!1}},setConfigTemplate(){const o={command:"python",args:["-m","your_module"]};this.serverConfigJson=JSON.stringify(o,null,2)},saveServer(){if(this.validateJson()){this.loading=!0;try{const o=JSON.parse(this.serverConfigJson),s={name:this.currentServer.name,active:this.currentServer.active,...o},u=this.isEditMode?"/api/tools/mcp/update":"/api/tools/mcp/add";V.post(u,s).then(f=>{this.loading=!1,this.showMcpServerDialog=!1,this.getServers(),this.getTools(),this.showSuccess(f.data.message||"保存成功!"),this.resetForm()}).catch(f=>{var r,d;this.loading=!1,this.showError("保存失败: "+(((d=(r=f.response)==null?void 0:r.data)==null?void 0:d.message)||f.message))})}catch(o){this.loading=!1,this.showError(`JSON 解析错误: ${o.message}`)}}},deleteServer(o){let s=o.name||o;confirm(`确定要删除服务器 ${s} 吗?`)&&V.post("/api/tools/mcp/delete",{name:s}).then(u=>{this.getServers(),this.getTools(),this.showSuccess(u.data.message||"删除成功!")}).catch(u=>{var f,r;this.showError("删除失败: "+(((r=(f=u.response)==null?void 0:f.data)==null?void 0:r.message)||u.message))})},editServer(o){const s={...o};try{delete s.name,delete s.active,delete s.tools,delete s.errlogs}catch(u){console.error("Error removing basic fields: ",u)}this.currentServer={name:o.name,active:o.active,tools:o.tools||[]},this.serverConfigJson=JSON.stringify(s,null,2),this.isEditMode=!0,this.showMcpServerDialog=!0},updateServerStatus(o){o.active=!o.active,V.post("/api/tools/mcp/update",o).then(s=>{this.getServers(),this.showSuccess(s.data.message||"更新成功!")}).catch(s=>{var u,f;this.showError("更新失败: "+(((f=(u=s.response)==null?void 0:u.data)==null?void 0:f.message)||s.message)),o.active=!o.active})},closeServerDialog(){this.showMcpServerDialog=!1,this.resetForm()},resetForm(){this.currentServer={name:"",active:!0,tools:[]},this.serverConfigJson="",this.jsonError=null,this.isEditMode=!1},showSuccess(o){this.save_message=o,this.save_message_success="success",this.save_message_snack=!0},showError(o){this.save_message=o,this.save_message_success="error",this.save_message_snack=!0},fetchMarketplaceServers(o=1){this.marketplaceLoading=!0;const s={page:o,page_size:this.marketPageSize};this.marketplaceSearch.trim()&&(s.search=this.marketplaceSearch.trim()),V.get("/api/tools/mcp/market",{params:s}).then(u=>{this.marketplaceServers=u.data.data.mcpservers||[],u.data.data.pagination?(this.totalMarketItems=u.data.data.pagination.total||0,this.totalMarketPages=u.data.data.pagination.totalPages||1,this.currentMarketPage=u.data.data.pagination.currentPage||1):this.totalMarketPages=Math.ceil(this.marketplaceServers.length/this.marketPageSize)||1,this.marketplaceLoading=!1}).catch(u=>{this.showError("获取 MCP 市场服务器列表失败: "+u.message),this.marketplaceLoading=!1})},searchMarketplaceServers(){this.currentMarketPage=1,this.fetchMarketplaceServers(1)},changePage(o){this.fetchMarketplaceServers(o)},showServerDetail(o){this.selectedMarketplaceServer=o;try{if(o.config){const s=JSON.parse(o.config);this.selectedServerConfigDisplay=JSON.stringify(s[0],null,2)}else this.selectedServerConfigDisplay="// 无可用配置"}catch(s){this.selectedServerConfigDisplay="// 配置解析错误: "+s.message}this.showServerDetailDialog=!0},importServerConfig(o){try{if(!o.config){this.showError("此服务器没有可用配置");return}const s=JSON.parse(o.config);if(!s||!s[0]||!s[0].mcpServers){this.showError("服务器配置格式不正确");return}const u=o.name,f=s[0];this.currentServer={name:u,active:!0,tools:[]},this.serverConfigJson=JSON.stringify(f,null,2),this.showServerDetailDialog=!1,this.isEditMode=!1,this.showMcpServerDialog=!0}catch(s){this.showError("导入配置失败: "+s.message)}}}},h=o=>(oe("data-v-40820d48"),o=o(),re(),o),ue={class:"tools-page"},pe={class:"text-h4 font-weight-bold mb-2"},he={class:"text-subtitle-1 text-medium-emphasis mb-4 d-flex align-center"},fe=h(()=>l("span",null,"函数调用和 MCP 是什么？",-1)),ge=h(()=>l("span",null,"浏览和安装来自社区的 MCP 服务器",-1)),_e=h(()=>l("span",{class:"text-h6"},"MCP 服务器",-1)),ve={class:"d-flex align-center mb-2"},Se=["title"],ye={key:0},ke={class:"d-flex align-center mb-1"},xe={class:"text-caption text-medium-emphasis"},be={key:1,class:"text-caption text-medium-emphasis mt-2"},Ce=h(()=>l("span",{class:"text-h6"},"函数工具",-1)),we={key:0,class:"text-center pa-8"},Ve=h(()=>l("p",{class:"text-grey mt-4"},"没有可用的函数工具",-1)),Me={key:1},Pe={class:"d-flex align-center"},Ee=["title"],Te={class:"text-body-1 font-weight-medium mb-3"},De={class:"text-body-2 ml-6 mb-4"},ze={class:"text-body-1 font-weight-medium mb-3"},Je=h(()=>l("thead",null,[l("tr",null,[l("th",null,"参数名"),l("th",null,"类型"),l("th",null,"描述")])],-1)),Ue={class:"font-weight-medium"},Ie={key:1,class:"text-center pa-4 text-medium-emphasis"},Ne=h(()=>l("p",null,"此工具没有参数",-1)),Le=h(()=>l("span",{class:"text-h6"},"MCP 服务器市场",-1)),je={key:0,class:"text-center pa-8"},Oe=h(()=>l("p",{class:"text-grey mt-4"},"正在加载 MCP 服务器市场...",-1)),Be={key:1,class:"text-center pa-8"},Fe=h(()=>l("p",{class:"text-grey mt-4"},"暂无可用的 MCP 服务器",-1)),Ae=["title"],qe={class:"d-flex align-center mb-2"},Ge={class:"text-caption text-medium-emphasis"},Ke={key:1,class:"text-caption text-medium-emphasis mb-2"},We={class:"d-flex justify-center mt-4"},Ye={class:"mb-2 d-flex align-center"},He=h(()=>l("span",{class:"text-subtitle-1"},"服务器配置",-1)),Re=h(()=>l("div",null,[l("p",{class:"mb-1"},"MCP 服务器(stdio)配置支持以下字段:"),l("p",{class:"mb-1"},[l("code",null,"command"),i(": 命令名称 (例如 python 或 uv)")]),l("p",{class:"mb-1"},[l("code",null,"args"),i(': 命令参数数组 (例如 ["run", "server.py"])')]),l("p",{class:"mb-1"},[l("code",null,"env"),i(': 环境变量对象 (例如 {"api_key": "abc"})')]),l("p",{class:"mb-1"},[l("code",null,"cwd"),i(": 工作目录路径 (例如 /path/to/server)")]),l("p",{class:"mb-1"},[l("code",null,"encoding"),i(": 输出编码 (默认 utf-8)")]),l("p",{class:"mb-1"},[l("code",null,"encoding_error_handler"),i(": The text encoding error handler. Defaults to strict. ")]),l("p",{class:"mb-1"},"其他字段请参考 MCP 文档"),l("p",{class:"mb-1"},"⚠️ 如果您使用 Docker 部署 AstrBot, 请务必将 MCP 服务器装在 AstrBot 挂载好的 data 目录下")],-1)),Xe=h(()=>l("small",null,"1. 某些 MCP 服务器可能需要按照其要求在 env 中填充 `API_KEY` 或 `TOKEN` 等信息，请注意检查是否填写。",-1)),Qe=h(()=>l("br",null,null,-1)),Ze=h(()=>l("small",null,"2. 当配置中带有 url 参数时，将使用 SSE 的方式连接到服务器。",-1)),$e={class:"monaco-container"},et={key:0,class:"mt-2 text-error"},tt=h(()=>l("span",null,"服务器详情",-1)),st={class:"text-h5 mb-3"},lt={class:"mb-4"},at=h(()=>l("h3",{class:"text-subtitle-1 font-weight-bold mb-2"},"安装配置",-1)),ot={class:"monaco-container",style:{height:"200px"}},rt={key:0},it={class:"text-subtitle-1 font-weight-bold mb-2"},nt={class:"d-flex align-center"},ct={class:"font-weight-medium"},dt={class:"mb-3"},mt=h(()=>l("h4",{class:"text-subtitle-2 mb-2"},"参数列表",-1)),ut=h(()=>l("thead",null,[l("tr",null,[l("th",null,"参数名"),l("th",null,"类型"),l("th",null,"必填"),l("th",null,"描述")])],-1)),pt={class:"font-weight-medium"},ht={key:1};function ft(o,s,u,f,r,d){const R=L("item-card-grid"),N=L("VueMonacoEditor");return n(),p("div",ue,[e(X,{fluid:"",class:"pa-0"},{default:t(()=>[e(z,null,{default:t(()=>[e(D,{cols:"12"},{default:t(()=>[l("h1",pe,[e(m,{size:"x-large",color:"primary",class:"me-2"},{default:t(()=>[i("mdi-function-variant")]),_:1}),i("函数工具管理 ")]),l("p",he,[i(" 管理 MCP 服务器和查看可用的函数工具 "),e(J,{location:"top"},{activator:t(({props:a})=>[e(m,O(a,{size:"small",color:"primary",class:"ms-1 cursor-pointer",onClick:s[0]||(s[0]=S=>d.openurl("https://astrbot.app/use/function-calling.html"))}),{default:t(()=>[i(" mdi-information ")]),_:2},1040)]),default:t(()=>[fe]),_:1})])]),_:1})]),_:1}),e(Z,{modelValue:r.activeTab,"onUpdate:modelValue":s[1]||(s[1]=a=>r.activeTab=a),color:"primary",class:"mb-4","show-arrows":""},{default:t(()=>[e(B,{value:"local",class:"font-weight-medium"},{default:t(()=>[e(m,{start:""},{default:t(()=>[i("mdi-server")]),_:1}),i(" 本地服务器 ")]),_:1}),e(B,{value:"marketplace",class:"font-weight-medium"},{default:t(()=>[e(m,{start:""},{default:t(()=>[i("mdi-store")]),_:1}),i(" MCP 市场 "),e(J,{location:"top",activator:"parent"},{default:t(()=>[ge]),_:1})]),_:1})]),_:1},8,["modelValue"]),e($,{modelValue:r.activeTab,"onUpdate:modelValue":s[9]||(s[9]=a=>r.activeTab=a)},{default:t(()=>[e(F,{value:"local"},{default:t(()=>[e(b,{class:"mb-6",elevation:"2"},{default:t(()=>[e(M,{class:"d-flex align-center py-3 px-4"},{default:t(()=>[e(m,{color:"primary",class:"me-2"},{default:t(()=>[i("mdi-server")]),_:1}),_e,e(x),e(g,{color:"primary","prepend-icon":"mdi-refresh",variant:"tonal",onClick:d.getServers,loading:r.loading},{default:t(()=>[i(" 刷新 ")]),_:1},8,["onClick","loading"]),e(g,{color:"primary",style:{"margin-left":"8px"},"prepend-icon":"mdi-plus",variant:"tonal",onClick:s[2]||(s[2]=a=>r.showMcpServerDialog=!0)},{default:t(()=>[i(" 新增服务器 ")]),_:1})]),_:1}),e(P),e(C,{class:"px-4 py-3"},{default:t(()=>[e(R,{items:r.mcpServers||[],"title-field":"name","enabled-field":"active","empty-icon":"mdi-server-off","empty-text":"暂无 MCP 服务器，点击 新增服务器 添加",onToggleEnabled:d.updateServerStatus,onDelete:d.deleteServer,onEdit:d.editServer},{"item-details":t(({item:a})=>[l("div",ve,[e(m,{size:"small",color:"grey",class:"me-2"},{default:t(()=>[i("mdi-file-code")]),_:1}),l("span",{class:"text-caption text-medium-emphasis text-truncate",title:d.getServerConfigSummary(a)},c(d.getServerConfigSummary(a)),9,Se)]),a.tools&&a.tools.length>0?(n(),p("div",ye,[l("div",ke,[e(m,{size:"small",color:"grey",class:"me-2"},{default:t(()=>[i("mdi-tools")]),_:1}),l("span",xe,"可用工具 ("+c(a.tools.length)+")",1)]),e(A,{class:"tool-chips"},{default:t(()=>[(n(!0),p(y,null,w(a.tools,(S,_)=>(n(),v(E,{key:_,size:"x-small",density:"compact",color:"info",class:"text-caption"},{default:t(()=>[i(c(S),1)]),_:2},1024))),128))]),_:2},1024)])):(n(),p("div",be,[e(m,{size:"small",color:"warning",class:"me-1"},{default:t(()=>[i("mdi-alert-circle")]),_:1}),i(" 无可用工具 ")]))]),_:1},8,["items","onToggleEnabled","onDelete","onEdit"])]),_:1})]),_:1}),e(b,{elevation:"2"},{default:t(()=>[e(M,{class:"d-flex align-center py-3 px-4"},{default:t(()=>[e(m,{color:"primary",class:"me-2"},{default:t(()=>[i("mdi-function")]),_:1}),Ce,e(E,{color:"info",size:"small",class:"ml-2"},{default:t(()=>[i(c(r.tools.length),1)]),_:1}),e(x),e(g,{variant:"text",color:"primary",onClick:s[3]||(s[3]=a=>r.showTools=!r.showTools)},{default:t(()=>[i(c(r.showTools?"收起":"展开")+" ",1),e(m,null,{default:t(()=>[i(c(r.showTools?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:1})]),_:1})]),_:1}),e(P),e(ee,null,{default:t(()=>[r.showTools?(n(),v(C,{key:0,class:"pa-3"},{default:t(()=>[r.tools.length===0?(n(),p("div",we,[e(m,{size:"64",color:"grey-lighten-1"},{default:t(()=>[i("mdi-api-off")]),_:1}),Ve])):(n(),p("div",Me,[e(U,{modelValue:r.toolSearch,"onUpdate:modelValue":s[4]||(s[4]=a=>r.toolSearch=a),"prepend-inner-icon":"mdi-magnify",label:"搜索函数工具",variant:"outlined",density:"compact",class:"mb-4","hide-details":"",clearable:""},null,8,["modelValue"]),e(q,{modelValue:r.openedPanel,"onUpdate:modelValue":s[5]||(s[5]=a=>r.openedPanel=a),multiple:""},{default:t(()=>[(n(!0),p(y,null,w(d.filteredTools,(a,S)=>(n(),v(K,{key:S,value:S,class:"mb-2 tool-panel",rounded:"lg"},{default:t(()=>[e(W,null,{default:t(()=>[e(z,{"no-gutters":"",align:"center"},{default:t(()=>[e(D,{cols:"3"},{default:t(()=>[l("div",Pe,[e(m,{color:"primary",class:"me-2",size:"small"},{default:t(()=>[i(c(a.function.name.includes(":")?"mdi-server-network":"mdi-function-variant"),1)]),_:2},1024),l("span",{class:"text-body-1 text-high-emphasis font-weight-medium text-truncate",title:a.function.name},c(d.formatToolName(a.function.name)),9,Ee)])]),_:2},1024),e(D,{cols:"9",class:"text-grey"},{default:t(()=>[i(c(a.function.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(Y,null,{default:t(()=>[e(b,{flat:""},{default:t(()=>[e(C,null,{default:t(()=>[l("p",Te,[e(m,{color:"primary",size:"small",class:"me-1"},{default:t(()=>[i("mdi-information")]),_:1}),i(" 功能描述 ")]),l("p",De,c(a.function.description),1),a.function.parameters&&a.function.parameters.properties?(n(),p(y,{key:0},[l("p",ze,[e(m,{color:"primary",size:"small",class:"me-1"},{default:t(()=>[i("mdi-code-json")]),_:1}),i(" 参数列表 ")]),e(H,{density:"compact",class:"params-table mt-1"},{default:t(()=>[Je,l("tbody",null,[(n(!0),p(y,null,w(a.function.parameters.properties,(_,k)=>(n(),p("tr",{key:k},[l("td",Ue,c(k),1),l("td",null,[e(E,{size:"x-small",color:"primary",text:"",class:"text-caption"},{default:t(()=>[i(c(_.type),1)]),_:2},1024)]),l("td",null,c(_.description),1)]))),128))])]),_:2},1024)],64)):(n(),p("div",Ie,[e(m,{size:"large",color:"grey-lighten-1"},{default:t(()=>[i("mdi-code-brackets")]),_:1}),Ne]))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]))]),_:1})):T("",!0)]),_:1})]),_:1})]),_:1}),e(F,{value:"marketplace"},{default:t(()=>[e(b,{elevation:"2"},{default:t(()=>[e(M,{class:"d-flex align-center py-3 px-4"},{default:t(()=>[e(m,{color:"primary",class:"me-2"},{default:t(()=>[i("mdi-store")]),_:1}),Le,e(x),e(U,{modelValue:r.marketplaceSearch,"onUpdate:modelValue":[s[6]||(s[6]=a=>r.marketplaceSearch=a),d.searchMarketplaceServers],"prepend-inner-icon":"mdi-magnify",label:"搜索服务器",variant:"outlined",density:"compact","hide-details":"",class:"mx-2",style:{"max-width":"300px"},clearable:""},null,8,["modelValue","onUpdate:modelValue"]),e(g,{color:"primary","prepend-icon":"mdi-refresh",variant:"text",onClick:s[7]||(s[7]=a=>d.fetchMarketplaceServers(1)),loading:r.marketplaceLoading},{default:t(()=>[i(" 刷新 ")]),_:1},8,["loading"])]),_:1}),e(P),e(C,{class:"pa-3"},{default:t(()=>[r.marketplaceLoading?(n(),p("div",je,[e(te,{indeterminate:"",color:"primary",size:"64"}),Oe])):d.filteredMarketplaceServers.length===0?(n(),p("div",Be,[e(m,{size:"64",color:"grey-lighten-1"},{default:t(()=>[i("mdi-store-off")]),_:1}),Fe])):(n(),v(z,{key:2},{default:t(()=>[(n(!0),p(y,null,w(d.filteredMarketplaceServers,(a,S)=>(n(),v(D,{key:S,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(b,{class:"marketplace-card hover-elevation",height:"100%"},{default:t(()=>[e(M,{class:"d-flex align-center pb-1 pt-3"},{default:t(()=>[l("span",{class:"text-h4 text-truncate",title:a.name},c(a.name_h)+"("+c(a.name)+") ",9,Ae),e(g,{icon:"mdi-open-in-new",variant:"text",color:"primary",class:"ms-auto",onClick:G(_=>d.openurl(a.origin),["stop"])},null,8,["onClick"])]),_:2},1024),e(C,null,{default:t(()=>[l("div",qe,[e(m,{size:"small",color:"grey",class:"me-2"},{default:t(()=>[i("mdi-tools")]),_:1}),l("span",Ge," 可用工具 ("+c(a.tools?a.tools.length:0)+") ",1)]),a.tools&&a.tools.length>0?(n(),v(A,{key:0,class:"tool-chips mb-2"},{default:t(()=>[(n(!0),p(y,null,w(a.tools,(_,k)=>(n(),v(E,{key:k,size:"x-small",density:"compact",color:"info",class:"text-caption"},{default:t(()=>[i(c(_.name),1)]),_:2},1024))),128))]),_:2},1024)):(n(),p("div",Ke,[e(m,{size:"small",color:"warning",class:"me-1"},{default:t(()=>[i("mdi-alert-circle")]),_:1}),i(" 无可用工具信息 ")]))]),_:2},1024),e(P),e(I,{class:"pa-2"},{default:t(()=>[e(x),e(g,{variant:"text",size:"small",color:"info","prepend-icon":"mdi-information-outline",onClick:_=>d.showServerDetail(a)},{default:t(()=>[i(" 详情 ")]),_:2},1032,["onClick"]),e(g,{variant:"text",size:"small",color:"primary","prepend-icon":"mdi-plus",onClick:_=>d.importServerConfig(a)},{default:t(()=>[i(" 导入 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})),l("div",We,[!r.marketplaceLoading&&r.totalMarketPages>1?(n(),v(se,{key:0,modelValue:r.currentMarketPage,"onUpdate:modelValue":[s[8]||(s[8]=a=>r.currentMarketPage=a),d.changePage],length:r.totalMarketPages,"total-visible":"7",rounded:""},null,8,["modelValue","length","onUpdate:modelValue"])):T("",!0)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(j,{modelValue:r.showMcpServerDialog,"onUpdate:modelValue":s[13]||(s[13]=a=>r.showMcpServerDialog=a),"max-width":"750px",persistent:""},{default:t(()=>[e(b,null,{default:t(()=>[e(M,{class:"bg-primary text-white py-3"},{default:t(()=>[e(m,{color:"white",class:"me-2"},{default:t(()=>[i(c(r.isEditMode?"mdi-pencil":"mdi-plus"),1)]),_:1}),l("span",null,c(r.isEditMode?"编辑":"新增")+" MCP 服务器",1)]),_:1}),e(C,{class:"py-4"},{default:t(()=>[e(le,{onSubmit:G(d.saveServer,["prevent"]),ref:"form"},{default:t(()=>[e(U,{modelValue:r.currentServer.name,"onUpdate:modelValue":s[10]||(s[10]=a=>r.currentServer.name=a),label:"服务器名称",variant:"outlined",rules:[a=>!!a||"名称是必填项"],required:"",class:"mb-3"},null,8,["modelValue","rules"]),e(ae,{modelValue:r.currentServer.active,"onUpdate:modelValue":s[11]||(s[11]=a=>r.currentServer.active=a),label:"启用服务器",color:"primary","hide-details":"",class:"mb-3"},null,8,["modelValue"]),l("div",Ye,[He,e(J,{location:"top"},{activator:t(({props:a})=>[e(m,O(a,{class:"ms-2",size:"small",color:"primary"}),{default:t(()=>[i("mdi-information")]),_:2},1040)]),default:t(()=>[Re]),_:1}),e(x),e(g,{size:"small",color:"info",variant:"text",onClick:d.setConfigTemplate,class:"me-1"},{default:t(()=>[i(" 使用模板 ")]),_:1},8,["onClick"])]),Xe,Qe,Ze,l("div",$e,[e(N,{value:r.serverConfigJson,"onUpdate:value":s[12]||(s[12]=a=>r.serverConfigJson=a),theme:"vs-dark",language:"json",options:{minimap:{enabled:!1},scrollBeyondLastLine:!1,automaticLayout:!0,lineNumbers:"on",roundedSelection:!0,tabSize:2},onChange:d.validateJson},null,8,["value","onChange"])]),r.jsonError?(n(),p("div",et,[e(m,{color:"error",size:"small",class:"me-1"},{default:t(()=>[i("mdi-alert-circle")]),_:1}),l("span",null,c(r.jsonError),1)])):T("",!0)]),_:1},8,["onSubmit"])]),_:1}),e(P),e(I,{class:"pa-4"},{default:t(()=>[e(x),e(g,{variant:"text",onClick:d.closeServerDialog,disabled:r.loading},{default:t(()=>[i(" 取消 ")]),_:1},8,["onClick","disabled"]),e(g,{color:"primary",onClick:d.saveServer,loading:r.loading,disabled:!d.isServerFormValid},{default:t(()=>[i(" 保存 ")]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(j,{modelValue:r.showServerDetailDialog,"onUpdate:modelValue":s[18]||(s[18]=a=>r.showServerDetailDialog=a),"max-width":"800px"},{default:t(()=>[e(b,null,{default:t(()=>[e(M,{class:"bg-primary text-white py-3"},{default:t(()=>[e(m,{color:"white",class:"me-2"},{default:t(()=>[i("mdi-information-outline")]),_:1}),tt,e(x),e(g,{icon:"",variant:"text",color:"white",onClick:s[14]||(s[14]=a=>r.showServerDetailDialog=!1)},{default:t(()=>[e(m,null,{default:t(()=>[i("mdi-close")]),_:1})]),_:1})]),_:1}),r.selectedMarketplaceServer?(n(),v(C,{key:0,class:"py-4"},{default:t(()=>[l("h2",st,c(r.selectedMarketplaceServer.name),1),l("div",lt,[at,l("div",ot,[e(N,{value:r.selectedServerConfigDisplay,"onUpdate:value":s[15]||(s[15]=a=>r.selectedServerConfigDisplay=a),theme:"vs-dark",language:"json",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,automaticLayout:!0,lineNumbers:"on",tabSize:2}},null,8,["value"])])]),r.selectedMarketplaceServer.tools&&r.selectedMarketplaceServer.tools.length>0?(n(),p("div",rt,[l("h3",it,[i(" 可用工具 "),e(E,{color:"info",size:"small",class:"ml-1"},{default:t(()=>[i(c(r.selectedMarketplaceServer.tools.length),1)]),_:1})]),e(q,null,{default:t(()=>[(n(!0),p(y,null,w(r.selectedMarketplaceServer.tools,(a,S)=>(n(),v(K,{key:S,class:"mb-2"},{default:t(()=>[e(W,null,{default:t(()=>[l("div",nt,[e(m,{color:"primary",class:"me-2",size:"small"},{default:t(()=>[i("mdi-function-variant")]),_:1}),l("span",ct,c(a.name),1)])]),_:2},1024),e(Y,null,{default:t(()=>[l("p",dt,c(a.description),1),a.inputSchema&&a.inputSchema.properties?(n(),p(y,{key:0},[mt,e(H,{density:"compact"},{default:t(()=>[ut,l("tbody",null,[(n(!0),p(y,null,w(a.inputSchema.properties,(_,k)=>(n(),p("tr",{key:k},[l("td",pt,c(k),1),l("td",null,[e(E,{size:"x-small",color:"primary",text:""},{default:t(()=>[i(c(_.type),1)]),_:2},1024)]),l("td",null,[a.inputSchema.required&&a.inputSchema.required.includes(k)?(n(),v(m,{key:0,color:"error",size:"small"},{default:t(()=>[i(" mdi-check ")]),_:1})):(n(),p("span",ht,"否"))]),l("td",null,c(_.description),1)]))),128))])]),_:2},1024)],64)):T("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):T("",!0)]),_:1})):T("",!0),e(P),e(I,{class:"pa-4"},{default:t(()=>[e(x),e(g,{variant:"text",onClick:s[16]||(s[16]=a=>r.showServerDetailDialog=!1)},{default:t(()=>[i(" 关闭 ")]),_:1}),e(g,{color:"primary","prepend-icon":"mdi-plus",onClick:s[17]||(s[17]=a=>d.importServerConfig(r.selectedMarketplaceServer))},{default:t(()=>[i(" 导入配置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{timeout:3e3,elevation:"24",color:r.save_message_success,modelValue:r.save_message_snack,"onUpdate:modelValue":s[19]||(s[19]=a=>r.save_message_snack=a),location:"top"},{default:t(()=>[i(c(r.save_message),1)]),_:1},8,["color","modelValue"])])}const kt=de(me,[["render",ft],["__scopeId","data-v-40820d48"]]);export{kt as default};
