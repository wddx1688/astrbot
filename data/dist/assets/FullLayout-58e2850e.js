import{d as be,o as m,c as I,a as _e,w as t,b as e,V as pe,e as r,t as C,f as H,g as B,h as ge,i as ye,j as fe,s as we,r as c,k as xe,l as L,m as S,n as Ve,F as ae,p as ke,q as o,u as i,v as p,x as he,y as J,z as Se,A as Ce,B as M,C as ve,D as K,E as oe,G as le,H as se,I as ee,J as Q,K as Z,L as Te,M as ze,N as V,O as ie,P as Ie,Q as ne,R as de,S as G,T as Ee,U as re,W as ue,X as Le,Y as Be,Z as De,_ as Ae,$ as ce,a0 as Re,a1 as Me,a2 as He,a3 as Ue,a4 as $e}from"./index-809c946b.js";import{m as me}from"./md5-bbe4f311.js";import{u as We}from"./common-a3b3ada7.js";import{m as Ne}from"./marked.esm-7c36e8b8.js";const O={Sidebar_drawer:!0,Customizer_drawer:!1,mini_sidebar:!1,fontTheme:"Roboto",inputBg:!1},te=be({id:"customizer",state:()=>({Sidebar_drawer:O.Sidebar_drawer,Customizer_drawer:O.Customizer_drawer,mini_sidebar:O.mini_sidebar,fontTheme:"Poppins",inputBg:O.inputBg}),getters:{},actions:{SET_SIDEBAR_DRAWER(){this.Sidebar_drawer=!this.Sidebar_drawer},SET_MINI_SIDEBAR(d){this.mini_sidebar=d},SET_FONT(d){this.fontTheme=d}}}),Pe=[{title:"统计",icon:"mdi-view-dashboard",to:"/dashboard/default"},{title:"消息平台",icon:"mdi-message-processing",to:"/platforms"},{title:"服务提供商",icon:"mdi-creation",to:"/providers"},{title:"MCP",icon:"mdi-function-variant",to:"/tool-use"},{title:"配置文件",icon:"mdi-cog",to:"/config"},{title:"插件管理",icon:"mdi-puzzle",to:"/extension"},{title:"插件市场",icon:"mdi-storefront",to:"/extension-marketplace"},{title:"聊天",icon:"mdi-chat",to:"/chat"},{title:"对话数据库",icon:"mdi-database",to:"/conversation"},{title:"控制台",icon:"mdi-console",to:"/console"},{title:"设置",icon:"mdi-wrench",to:"/settings"},{title:"关于",icon:"mdi-information",to:"/about"}],Xe={__name:"NavItem",props:{item:Object,level:Number},setup(d){return(f,h)=>(m(),I(fe,{to:d.item.type==="external"?"":d.item.to,href:d.item.type==="external"?d.item.to:"",rounded:"",class:"mb-1",color:"secondary",disabled:d.item.disabled,target:d.item.type==="external"?"_blank":""},_e({prepend:t(()=>[d.item.icon?(m(),I(H,{key:0,size:d.item.iconSize,class:"hide-menu",icon:d.item.icon},null,8,["size","icon"])):B("",!0)]),default:t(()=>[e(ge,{style:{"font-size":"14px"}},{default:t(()=>[r(C(d.item.title),1)]),_:1}),d.item.subCaption?(m(),I(ye,{key:0,class:"text-caption mt-n1 hide-menu"},{default:t(()=>[r(C(d.item.subCaption),1)]),_:1})):B("",!0)]),_:2},[d.item.chip?{name:"append",fn:t(()=>[e(pe,{color:d.item.chipColor,class:"sidebarchip hide-menu",size:d.item.chipIcon?"small":"default",variant:d.item.chipVariant,"prepend-icon":d.item.chipIcon},{default:t(()=>[r(C(d.item.chip),1)]),_:1},8,["color","size","variant","prepend-icon"])]),key:"0"}:void 0]),1032,["to","href","disabled","target"]))}},Ye={class:"text-center"},qe={style:{position:"absolute",bottom:"32px",width:"100%","font-size":"13px"},class:"text-center"},Fe={key:1,style:{display:"block"}},je={key:2,style:{display:"block"}},Ge=o("small",{style:{display:"block","margin-top":"8px"}},"AGPL-3.0",-1),Oe={style:{display:"flex","align-items":"center"}},Je=o("span",{style:{"margin-left":"8px"}},"拖拽",-1),Ke={style:{display:"flex",gap:"8px"}},Qe=o("iframe",{src:"https://astrbot.app",style:{width:"100%",height:"calc(100% - 56px)",border:"none","border-bottom-left-radius":"12px","border-bottom-right-radius":"12px"}},null,-1),Ze={__name:"VerticalSidebar",setup(d){const f=te(),h=we(Pe),E=c(!1),w=c(""),v=c(""),_=c(!1),x=c({position:"fixed",bottom:"16px",right:"16px",width:"490px",height:"640px",minWidth:"300px",minHeight:"200px",background:"white",resize:"both",overflow:"auto",zIndex:"10000000",borderRadius:"12px",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.1)"});window.innerWidth<768&&(x.value={position:"fixed",top:"10%",left:"0%",width:"100%",height:"50%",minWidth:"300px",minHeight:"200px",background:"white",resize:"both",overflow:"auto",zIndex:"1002",borderRadius:"12px",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.1)"},f.Sidebar_drawer=!1);const D={width:"100%",padding:"8px",background:"#f0f0f0",borderBottom:"1px solid #ccc",borderTopLeftRadius:"8px",borderTopRightRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"move"};function b(){E.value=!E.value}function P(){typeof window<"u"&&window.open("https://astrbot.app","_blank")}let A=0,U=0,T=!1;function $(n,u,g){return Math.min(Math.max(n,u),g)}function z(n,u){T=!0;const k=document.getElementById("draggable-iframe").getBoundingClientRect();A=n-k.left,U=u-k.top,document.body.style.userSelect="none",document.addEventListener("mousemove",W),document.addEventListener("mouseup",R),document.addEventListener("touchmove",Y,{passive:!1}),document.addEventListener("touchend",q)}function X(n){z(n.clientX,n.clientY)}function W(n){T&&N(n.clientX,n.clientY)}function R(){F()}function y(n){if(n.touches.length===1){const u=n.touches[0];z(u.clientX,u.clientY)}}function Y(n){if(T&&n.touches.length===1){n.preventDefault();const u=n.touches[0];N(u.clientX,u.clientY)}}function q(){F()}function N(n,u){const g=document.getElementById("draggable-iframe"),k=$(n-A,0,window.innerWidth-g.offsetWidth),l=$(u-U,0,window.innerHeight-g.offsetHeight);x.value.left=k+"px",x.value.top=l+"px"}function F(){T=!1,document.body.style.userSelect="",document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",R),document.removeEventListener("touchmove",Y),document.removeEventListener("touchend",q)}return xe(()=>{L.get("/api/stat/version").then(n=>{w.value="v"+n.data.data.version}).catch(n=>{console.log(n)}),L.get("/api/update/check?type=dashboard").then(n=>{_.value=n.data.data.has_new_version,v.value=n.data.data.current_version}).catch(n=>{console.log(n)})}),(n,u)=>(m(),S(ae,null,[e(Se,{left:"",modelValue:i(f).Sidebar_drawer,"onUpdate:modelValue":u[0]||(u[0]=g=>i(f).Sidebar_drawer=g),elevation:"0","rail-width":"80",app:"",class:"leftSidebar",width:"220",rail:i(f).mini_sidebar},{default:t(()=>[e(Ve,{class:"pa-4 listitem",style:{height:"auto"}},{default:t(()=>[(m(!0),S(ae,null,ke(h.value,(g,k)=>(m(),I(Xe,{key:k,item:g,class:"leftPadding"},null,8,["item"]))),128))]),_:1}),o("div",Ye,[e(pe,{color:"inputBorder",size:"small"},{default:t(()=>[r(C(w.value),1)]),_:1})]),o("div",qe,[i(f).mini_sidebar?B("",!0):(m(),I(fe,{key:0,onClick:b},{default:t(()=>[e(p,{variant:"plain",size:"small"},{default:t(()=>[r(" 🤔 点击此处 查看/关闭 悬浮文档！ ")]),_:1})]),_:1})),v.value?(m(),S("small",Fe,"WebUI 版本: "+C(v.value),1)):(m(),S("small",je,"构建: embedded")),e(he,{text:"使用 /dashboard_update 指令更新管理面板"},{activator:t(({props:g})=>[_.value?(m(),S("small",J({key:0},g,{style:{display:"block","margin-top":"4px"}}),"面板有更新",16)):B("",!0)]),_:1}),Ge])]),_:1},8,["modelValue","rail"]),E.value?(m(),S("div",{key:0,id:"draggable-iframe",style:Ce(x.value)},[o("div",{style:D,onMousedown:X,onTouchstart:y},[o("div",Oe,[e(H,{icon:"mdi-cursor-move"}),Je]),o("div",Ke,[e(p,{icon:"",onClick:M(P,["stop"]),onMousedown:u[1]||(u[1]=M(()=>{},["stop"])),style:{"border-radius":"8px",border:"1px solid #ccc"}},{default:t(()=>[e(H,{icon:"mdi-open-in-new"})]),_:1},8,["onClick"]),e(p,{icon:"",onClick:M(b,["stop"]),onMousedown:u[2]||(u[2]=M(()=>{},["stop"])),style:{"border-radius":"8px",border:"1px solid #ccc"}},{default:t(()=>[e(H,{icon:"mdi-close"})]),_:1},8,["onClick"])])],32),Qe],4)):B("",!0)],64))}},et=o("span",{style:{"margin-left":"16px","font-size":"24px","font-weight":"1000"}},[r("Astr"),o("span",{style:{"font-weight":"normal"}},"Bot")],-1),tt={class:"mr-4"},at={key:0},ot=o("span",{class:"text-h5"},"更新 AstrBot",-1),lt={style:{display:"inline-block"}},st={style:{"margin-left":"4px"}},it=["innerHTML"],nt=o("div",{class:"mb-4 mt-4"},[o("small",null,[r("💡 TIP: 跳到旧版本或者切换到某个版本不会重新下载管理面板文件，这可能会造成部分数据显示错误。您可在 "),o("a",{href:"https://github.com/Soulter/AstrBot/releases"},"此处"),r(" 找到对应的面板文件 dist.zip，解压后替换 data/dist 文件夹即可。当然，前端源代码在 dashboard 目录下，你也可以自己使用 npm install 和 npm build 构建。")])],-1),dt=o("div",{class:"mb-4"},[o("small",null,[r("`更新到最新版本` 按钮会同时尝试更新机器人主程序和管理面板。如果您正在使用 Docker 部署，也可以重新拉取镜像或者使用 "),o("a",{href:"https://containrrr.dev/watchtower/usage-overview/"},"watchtower"),r(" 来自动监控拉取。")])],-1),rt={style:{"margin-top":"16px"}},ut=o("h3",{class:"mb-4"},"手动输入版本号或 Commit SHA",-1),ct=o("div",{class:"mb-4"},[o("small",null,"如 v3.3.16 (不带 SHA) 或 42e5ec5d80b93b6bfe8b566754d45ffac4c3fe0b"),o("br"),o("a",{href:"https://github.com/Soulter/AstrBot/commits/master"},[o("small",null,"查看 master 分支提交记录（点击右边的 copy 即可复制）")])],-1),mt={style:{"margin-top":"16px"}},pt=o("h3",{class:"mb-4"},"单独更新管理面板到最新版本",-1),ft={class:"mb-4"},ht=o("br",null,null,-1),vt={class:"mb-4"},bt={key:0},_t={key:1},gt=o("span",{class:"text-h5"},"账户",-1),yt=o("div",null,"为了安全，请尽快修改默认密码。",-1),wt=o("small",null,"默认用户名和密码是 astrbot。",-1),xt=o("br",null,null,-1),Vt=ve({__name:"VerticalHeader",setup(d){const f=te();let h=c(!1),E=c(!1),w=c(!1),v=c(""),_=c(""),x=c(""),D=c(""),b=c(""),P=c(""),A=c(!1),U=c(""),T=c(!1),$=c(""),z=c(""),X=c([]),W=c([]),R=c(!1),y=c(0),Y=[{title:"标签",key:"tag_name"},{title:"发布时间",key:"published_at"},{title:"内容",key:"body"},{title:"源码地址",key:"zipball_url"},{title:"操作",key:"switch"}];function q(){v.value!=""&&(v.value=me.md5(v.value)),_.value!=""&&(_.value=me.md5(_.value)),L.post("/api/auth/account/edit",{password:v.value,new_password:_.value,new_username:x.value}).then(l=>{if(l.data.status=="error"){D.value=l.data.message,v.value="",_.value="";return}h.value=!h.value,D.value=l.data.message,setTimeout(()=>{ce().logout()},1e3)}).catch(l=>{console.log(l),D.value=l,v.value="",_.value=""})}function N(){b.value="正在检查更新...",L.get("/api/update/check").then(l=>{A.value=l.data.data.has_new_version,l.data.data.has_new_version?(P.value=l.data.message,b.value="有新版本！"):b.value=l.data.message,U.value=l.data.data.version,$.value=l.data.data.dashboard_version,T.value=l.data.data.dashboard_has_new_version}).catch(l=>{if(l.response.status==401){console.log("401"),ce().logout();return}console.log(l),b.value=l})}function F(){L.get("/api/update/releases").then(l=>{X.value=l.data.data.map(a=>(a.published_at=new Date(a.published_at).toLocaleString(),a))}).catch(l=>{console.log(l)})}function n(){fetch("https://api.github.com/repos/Soulter/AstrBot/commits",{headers:{Host:"api.github.com",Referer:"https://api.github.com"}}).then(l=>l.json()).then(l=>{W.value=l.map(a=>({sha:a.sha,date:new Date(a.commit.author.date).toLocaleString(),message:a.commit.message}))}).catch(l=>{console.log(l)})}function u(l){b.value="正在切换版本...",R.value=!0,L.post("/api/update/do",{version:l,proxy:localStorage.getItem("selectedGitHubProxy")||""}).then(a=>{b.value=a.data.message,a.data.status=="ok"&&setTimeout(()=>{window.location.reload()},1e3)}).catch(a=>{console.log(a),b.value=a}).finally(()=>{R.value=!1})}function g(){b.value="正在更新...",L.post("/api/update/dashboard").then(l=>{b.value=l.data.message,l.data.status=="ok"&&setTimeout(()=>{window.location.reload()},1e3)}).catch(l=>{console.log(l),b.value=l})}N();const k=We();return k.createEventSource(),k.getStartTime(),localStorage.getItem("change_pwd_hint")!=null&&localStorage.getItem("change_pwd_hint")=="true"&&(h.value=!0,E.value=!0,localStorage.removeItem("change_pwd_hint")),(l,a)=>(m(),I(Ae,{elevation:"0",height:"55"},{default:t(()=>[e(p,{style:{"margin-left":"22px"},class:"hidden-md-and-down text-secondary",color:"lightsecondary",icon:"",rounded:"sm",variant:"flat",onClick:a[0]||(a[0]=M(s=>i(f).SET_MINI_SIDEBAR(!i(f).mini_sidebar),["stop"])),size:"small"},{default:t(()=>[e(H,null,{default:t(()=>[r("mdi-menu")]),_:1})]),_:1}),e(p,{class:"hidden-lg-and-up text-secondary ms-3",color:"lightsecondary",icon:"",rounded:"sm",variant:"flat",onClick:M(i(f).SET_SIDEBAR_DRAWER,["stop"]),size:"small"},{default:t(()=>[e(H,null,{default:t(()=>[r("mdi-menu")]),_:1})]),_:1},8,["onClick"]),et,e(K),o("div",tt,[i(A)?(m(),S("small",at," 有新版本！ ")):B("",!0)]),e(ue,{modelValue:i(w),"onUpdate:modelValue":a[9]||(a[9]=s=>V(w)?w.value=s:w=s),width:"1000"},{activator:t(({props:s})=>[e(p,J({onClick:a[1]||(a[1]=j=>{N(),F(),n()}),class:"text-primary mr-4",color:"lightprimary",variant:"flat",rounded:"sm"},s),{default:t(()=>[r(" 更新 🔄 ")]),_:2},1040)]),default:t(()=>[e(oe,null,{default:t(()=>[e(le,null,{default:t(()=>[ot]),_:1}),e(se,null,{default:t(()=>[e(ee,null,{default:t(()=>[Q(e(Te,{class:"mb-4",indeterminate:"",color:"primary"},null,512),[[Z,i(R)]]),o("div",null,[o("h1",lt,C(i(U)),1),o("small",st,C(i(b)),1)]),o("div",{style:{"background-color":"#646cff24",padding:"16px","border-radius":"10px","font-size":"14px","max-height":"400px","overflow-y":"auto"},innerHTML:i(Ne)(i(P)),class:"markdown-content"},null,8,it),nt,e(ze,{modelValue:i(y),"onUpdate:modelValue":a[2]||(a[2]=s=>V(y)?y.value=s:y=s)},{default:t(()=>[e(ie,{value:"0"},{default:t(()=>[r("😊 正式版")]),_:1}),e(ie,{value:"1"},{default:t(()=>[r("🧐 开发版(master 分支)")]),_:1})]),_:1},8,["modelValue"]),e(Ie,{modelValue:i(y),"onUpdate:modelValue":a[4]||(a[4]=s=>V(y)?y.value=s:y=s)},{default:t(()=>[Q(e(ne,{key:"0"},{default:t(()=>[e(p,{class:"mt-4 mb-4",onClick:a[3]||(a[3]=s=>u("latest")),color:"primary",style:{"border-radius":"10px"},disabled:!i(A)},{default:t(()=>[r(" 更新到最新版本 ")]),_:1},8,["disabled"]),dt,e(de,{headers:i(Y),items:i(X),"item-key":"name"},{"item.body":t(({item:s})=>[e(he,{text:s.body},{activator:t(({props:j})=>[e(p,J(j,{rounded:"xl",variant:"tonal",color:"primary",size:"small"}),{default:t(()=>[r("查看")]),_:2},1040)]),_:2},1032,["text"])]),"item.switch":t(({item:s})=>[e(p,{onClick:j=>u(s.tag_name),rounded:"xl",variant:"plain",color:"primary"},{default:t(()=>[r(" 切换 ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"])]),_:1},512),[[Z,i(y)==0]]),Q(e(ne,{key:"1"},{default:t(()=>[o("div",rt,[e(de,{headers:[{title:"SHA",key:"sha"},{title:"日期",key:"date"},{title:"信息",key:"message"},{title:"操作",key:"switch"}],items:i(W),"item-key":"sha"},{"item.switch":t(({item:s})=>[e(p,{onClick:j=>u(s.sha),rounded:"xl",variant:"plain",color:"primary"},{default:t(()=>[r(" 切换 ")]),_:2},1032,["onClick"])]),_:1},8,["items"])])]),_:1},512),[[Z,i(y)==1]])]),_:1},8,["modelValue"]),ut,e(G,{label:"输入版本号或 master 分支下的 commit hash。",modelValue:i(z),"onUpdate:modelValue":a[5]||(a[5]=s=>V(z)?z.value=s:z=s),required:"",variant:"outlined"},null,8,["modelValue"]),ct,e(p,{color:"error",style:{"border-radius":"10px"},onClick:a[6]||(a[6]=s=>u(i(z)))},{default:t(()=>[r(" 确定切换 ")]),_:1}),e(Ee,{class:"mt-4 mb-4"}),o("div",mt,[pt,o("div",ft,[o("small",null,"当前版本 "+C(i($)),1),ht]),o("div",vt,[i(T)?(m(),S("p",bt," 有新版本！ ")):(m(),S("p",_t," 已经是最新版本了。 "))]),e(p,{color:"primary",style:{"border-radius":"10px"},onClick:a[7]||(a[7]=s=>g()),disabled:!i(T)},{default:t(()=>[r(" 下载并更新 ")]),_:1},8,["disabled"])])]),_:1})]),_:1}),e(re,null,{default:t(()=>[e(K),e(p,{color:"blue-darken-1",variant:"text",onClick:a[8]||(a[8]=s=>V(w)?w.value=!1:w=!1)},{default:t(()=>[r(" 关闭 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ue,{modelValue:i(h),"onUpdate:modelValue":a[14]||(a[14]=s=>V(h)?h.value=s:h=s),persistent:"",width:"700"},{activator:t(({props:s})=>[e(p,J({class:"text-primary mr-4",color:"lightprimary",variant:"flat",rounded:"sm"},s),{default:t(()=>[r(" 账户 📰 ")]),_:2},1040)]),default:t(()=>[e(oe,null,{default:t(()=>[e(le,null,{default:t(()=>[gt]),_:1}),e(se,null,{default:t(()=>[e(ee,null,{default:t(()=>[e(Le,null,{default:t(()=>[e(Be,{cols:"12"},{default:t(()=>[i(E)?(m(),I(De,{key:0,color:"warning",style:{"margin-bottom":"16px"}},{default:t(()=>[yt]),_:1})):B("",!0),e(G,{label:"原密码*",type:"password",modelValue:i(v),"onUpdate:modelValue":a[10]||(a[10]=s=>V(v)?v.value=s:v=s),required:"",variant:"outlined"},null,8,["modelValue"]),e(G,{label:"新用户名",modelValue:i(x),"onUpdate:modelValue":a[11]||(a[11]=s=>V(x)?x.value=s:x=s),required:"",variant:"outlined"},null,8,["modelValue"]),e(G,{label:"新密码",type:"password",modelValue:i(_),"onUpdate:modelValue":a[12]||(a[12]=s=>V(_)?_.value=s:_=s),required:"",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),wt,xt,o("small",null,C(i(D)),1)]),_:1}),e(re,null,{default:t(()=>[e(K),e(p,{color:"blue-darken-1",variant:"text",onClick:a[13]||(a[13]=s=>V(h)?h.value=!1:h=!1)},{default:t(()=>[r(" 关闭 ")]),_:1}),e(p,{color:"blue-darken-1",variant:"text",onClick:q},{default:t(()=>[r(" 提交 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});const kt={style:{height:"100%"}},It=ve({__name:"FullLayout",setup(d){const f=te();return(h,E)=>(m(),I(Ue,null,{default:t(()=>[e(He,{theme:"PurpleTheme",class:Me([i(f).fontTheme,i(f).mini_sidebar?"mini-sidebar":"",i(f).inputBg?"inputWithbg":""])},{default:t(()=>[e(Vt),e(Ze),e(Re,null,{default:t(()=>[e(ee,{fluid:"",class:"page-wrapper",style:{height:"calc(100% - 8px)"}},{default:t(()=>[o("div",kt,[e(i($e))])]),_:1})]),_:1})]),_:1},8,["class"])]),_:1}))}});export{It as default};
