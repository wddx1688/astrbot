import{E as L,H as v}from"./github-d8d05c61.js";import{W as z}from"./WaitingForRestart-f77d905b.js";import{A as T}from"./AstrBotConfig-b6194601.js";import{C as A}from"./ConsoleDisplayer-6264eb94.js";import{m as d,b as s,w as o,X as _,W as S,ae as I,F as D,l as b,o as i,c as f,ar as B,Y as c,g as k,E as V,G as x,q as n,v as m,f as y,e as u,x as G,t as p,D as C,S as R,H as M,p as E,R as U,y as j,I as N,as as W,U as P,T as $,V as F}from"./index-809c946b.js";import{u as q}from"./common-a3b3ada7.js";import{m as H}from"./marked.esm-7c36e8b8.js";import"./_plugin-vue_export-helper-c27b6911.js";const K={class:"pl-2 pt-2 d-flex align-center pe-2"},O=n("h2",null,"âœ¨ æ’ä»¶å¸‚åœº",-1),J=n("span",null," å¦‚æ— æ³•æ˜¾ç¤ºï¼Œè¯·å•å‡»æ­¤æŒ‰é’®è·³è½¬è‡³æ’ä»¶å¸‚åœºï¼Œå¤åˆ¶æƒ³å®‰è£…æ’ä»¶å¯¹åº”çš„ `repo` é“¾æŽ¥ç„¶åŽç‚¹å‡»å³ä¸‹è§’ + å·å®‰è£…ï¼Œæˆ–æ‰“å¼€é“¾æŽ¥ä¸‹è½½åŽ‹ç¼©åŒ…å®‰è£…ã€‚ å¦‚æžœå› ä¸ºç½‘ç»œé—®é¢˜å®‰è£…å¤±è´¥ï¼Œç‚¹å‡»è®¾ç½®é¡µé€‰æ‹© GitHub åŠ é€Ÿåœ°å€ã€‚æˆ–å‰å¾€ä»“åº“ä¸‹è½½åŽ‹ç¼©åŒ…ç„¶åŽæœ¬åœ°ä¸Šä¼ ã€‚ ",-1),X=n("small",{style:{color:"#bbb"}},"æ¯ä¸ªæ’ä»¶éƒ½æ˜¯ä½œè€…æ— å¿æä¾›çš„çš„åŠ³åŠ¨æˆæžœã€‚å¦‚æžœæ‚¨å–œæ¬¢æŸä¸ªæ’ä»¶ï¼Œè¯· Starï¼",-1),Y={key:0,class:"mt-4"},Z=n("h2",null,"ðŸ¥³ æŽ¨è",-1),Q={key:1,class:"mt-4"},ee=n("h2",null,"ðŸ“¦ å…¨éƒ¨æ’ä»¶",-1),te={class:"d-flex align-center",style:{"overflow-x":"scroll"}},ae=["src"],le={key:1},se=["href"],oe={key:2},ne={style:{"font-size":"13px"}},ie={style:{"font-size":"12px"}},re={key:0},de=["href"],ue={key:1},he=["href"],ge=["src","alt"],me={key:0},pe={key:2,class:"mt-4"},ce=n("h2",null,"ðŸ“¦ å…¨éƒ¨æ’ä»¶",-1),fe=n("small",null,[n("a",{href:"https://astrbot.app/dev/plugin.html"},"æ’ä»¶å¼€å‘æ–‡æ¡£")],-1),_e=n("small",null,[n("a",{href:"https://github.com/Soulter/AstrBot_Plugins_Collection"},"æäº¤æ’ä»¶ä»“åº“")],-1),ke=n("span",{class:"text-h5"},"å®‰è£…æ’ä»¶",-1),ye=n("h3",null,"ä»Ž GitHub ä¸Šåœ¨çº¿ä¸‹è½½",-1),we=n("small",null,"è¯·è¾“å…¥åˆæ³•çš„ GitHub ä»“åº“é“¾æŽ¥ï¼Œå½“å‰ä»…æ”¯æŒ GitHubã€‚å¦‚ï¼šhttps://github.com/Soulter/astrbot_plugin_aiocqhttp",-1),De=n("h3",null,"ä»Žæœ¬æœºä¸Šä¼  .zip åŽ‹ç¼©åŒ…",-1),be=n("small",null,"è¯·ä¿è¯æ’ä»¶æ–‡ä»¶å­˜åœ¨åŽ‹ç¼©åŒ…æ ¹ç›®å½•ä¸­çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼ˆå³ç±»ä¼¼äºŽä»Ž GitHub ä»“åº“é¡µä¸Šä¸‹è½½çš„ Zip åŽ‹ç¼©åŒ…çš„æ ¼å¼ï¼‰ã€‚",-1),ve=n("br",null,null,-1),Ve=n("span",{class:"text-h5"},"æ’ä»¶è¯´æ˜Žæ–‡æ¡£",-1),xe=["innerHTML"],Ce={key:1,class:"d-flex flex-column align-center justify-center",style:{height:"100%"}},Me={class:"text-body-1 text-center mb-4"},Ee={key:2,class:"d-flex flex-column align-center justify-center",style:{height:"100%"}},Le=n("p",{class:"text-body-1 text-center mb-4"},[u("è¯¥æ’ä»¶æœªæä¾›æ–‡æ¡£é“¾æŽ¥æˆ–GitHubä»“åº“åœ°å€ã€‚"),n("br"),u("è¯·æŸ¥çœ‹æ’ä»¶å¸‚åœºæˆ–è”ç³»æ’ä»¶ä½œè€…èŽ·å–æ›´å¤šä¿¡æ¯ã€‚")],-1),Se={name:"ExtensionPage",components:{ExtensionCard:L,WaitingForRestart:z,ConsoleDisplayer:A,AstrBotConfig:T},data(){return{extension_data:{data:[],message:""},extension_url:"",status:"",dialog:!1,snack_message:"",snack_show:!1,snack_success:"success",loading_:!1,upload_file:null,pluginMarketData:[],loadingDialog:{show:!1,title:"åŠ è½½ä¸­...",statusCode:0,result:""},readmeDialog:{show:!1,url:null,content:null,error:null},announcement:"",isListView:!0,pluginMarketHeaders:[{title:"åç§°",key:"name",maxWidth:"200px"},{title:"æè¿°",key:"desc",maxWidth:"250px"},{title:"ä½œè€…",key:"author",maxWidth:"70px"},{title:"Staræ•°",key:"stars",maxWidth:"100px"},{title:"æ ‡ç­¾",key:"tags",maxWidth:"100px"},{title:"æ“ä½œ",key:"actions",sortable:!1}],marketSearch:"",commonStore:q(),filterKeys:["name","desc","author"]}},computed:{filteredPluginMarketData(){if(!this.marketSearch)return this.pluginMarketData;const l=this.marketSearch.toLowerCase();return this.pluginMarketData.filter(e=>this.filterKeys.some(a=>{var t;return(t=e[a])==null?void 0:t.toLowerCase().includes(l)}))},pinnedPlugins(){return this.pluginMarketData.filter(l=>l==null?void 0:l.pinned)}},mounted(){this.getExtensions(),this.loading_=!0,this.commonStore.getPluginCollections().then(l=>{this.pluginMarketData=l,this.checkAlreadyInstalled(),this.checkUpdate(),this.loading_=!1}).catch(l=>{console.error("èŽ·å–æ’ä»¶å¸‚åœºæ•°æ®å¤±è´¥:",l)}),b.get("https://api.soulter.top/astrbot-announcement-plugin-market").then(l=>{let e=l.data.data;this.announcement=e.text})},methods:{open(l){l&&window.open(l,"_blank")},jumpToPluginMarket(){window.open("https://soulter.github.io/AstrBot_Plugins_Collection/plugins.json","_blank")},toast(l,e){this.snack_message=l,this.snack_show=!0,this.snack_success=e},resetLoadingDialog(){this.loadingDialog={show:!1,title:"åŠ è½½ä¸­...",statusCode:0,result:""}},onLoadingDialogResult(l,e,a=2e3){this.loadingDialog.statusCode=l,this.loadingDialog.result=e,a!==-1&&setTimeout(()=>{this.resetLoadingDialog()},a)},getExtensions(){b.get("/api/plugin/get").then(l=>{this.extension_data=l.data,this.checkAlreadyInstalled(),this.checkUpdate()})},checkUpdate(){const l=new Map,e=new Map;this.pluginMarketData.forEach(a=>{a.repo&&l.set(a.repo.toLowerCase(),a),e.set(a.name,a)}),this.extension_data.data.forEach(a=>{var w;const t=(w=a.repo)==null?void 0:w.toLowerCase(),g=t?l.get(t):null,r=e.get(a.name),h=g||r;h?(a.online_version=h.version,a.has_update=a.version!==h.version&&h.version!=="æœªçŸ¥"):a.has_update=!1})},async getReadmeUrl(l){l=l.replace(/\/+$/,"");const e=l.match(/github\.com\/([^/]+)\/([^/]+)/);if(!e)throw new Error("æ— æ•ˆçš„ GitHub ä»“åº“åœ°å€");const a=e[1],t=e[2],g=`https://api.github.com/repos/${a}/${t}`;try{const h=await(await fetch(g)).json(),w=(h==null?void 0:h.default_branch)||"master";return`${l}/blob/${w}/README.md`}catch(r){return console.error("èŽ·å–é»˜è®¤åˆ†æ”¯å¤±è´¥ï¼Œä½¿ç”¨ master ä½œä¸ºé»˜è®¤ï¼š",r),`${l}/blob/master/README.md`}},async showReadmeDialog(l){var e,a;this.readmeDialog.content=null,this.readmeDialog.error=null,(a=(e=l==null?void 0:l.data)==null?void 0:e.data)!=null&&a.repo?(this.readmeDialog.url=await this.getReadmeUrl(l.data.data.repo),l.data.data.readme?this.readmeDialog.content=l.data.data.readme:this.readmeDialog.error="æ’ä»¶æœªæä¾›READMEæ–‡æ¡£"):(this.readmeDialog.url=null,this.readmeDialog.error="æ’ä»¶æ²¡æœ‰ä»“åº“ä¿¡æ¯æˆ–READMEæ–‡æ¡£"),this.readmeDialog.show=!0},async newExtension(){if(this.extension_url===""&&this.upload_file===null){this.toast("è¯·å¡«å†™æ’ä»¶é“¾æŽ¥æˆ–ä¸Šä¼ æ’ä»¶æ–‡ä»¶","error");return}if(this.extension_url!==""&&this.upload_file!==null){this.toast("è¯·ä¸è¦åŒæ—¶å¡«å†™æ’ä»¶é“¾æŽ¥å’Œä¸Šä¼ æ’ä»¶æ–‡ä»¶","error");return}if(this.loading_=!0,this.loadingDialog.show=!0,this.upload_file!==null){this.toast("æ­£åœ¨ä»Žæ–‡ä»¶å®‰è£…æ’ä»¶","primary");const l=new FormData;l.append("file",this.upload_file),b.post("/api/plugin/install-upload",l,{headers:{"Content-Type":"multipart/form-data"}}).then(async e=>{if(this.loading_=!1,e.data.status==="error"){this.onLoadingDialogResult(2,e.data.message,-1);return}this.extension_data=e.data,this.upload_file="",this.onLoadingDialogResult(1,e.data.message),this.dialog=!1,this.getExtensions(),await this.showReadmeDialog(e)}).catch(e=>{this.loading_=!1,this.onLoadingDialogResult(2,e,-1)});return}else this.toast("æ­£åœ¨ä»Žé“¾æŽ¥ "+this.extension_url+" å®‰è£…æ’ä»¶...","primary"),b.post("/api/plugin/install",{url:this.extension_url,proxy:localStorage.getItem("selectedGitHubProxy")||""}).then(async l=>{if(this.loading_=!1,this.toast(l.data.message,l.data.status==="ok"?"success":"error"),l.data.status==="error"){this.onLoadingDialogResult(2,l.data.message,-1);return}this.extension_data=l.data,this.extension_url="",this.onLoadingDialogResult(1,l.data.message),this.dialog=!1,this.getExtensions(),await this.showReadmeDialog(l)}).catch(l=>{this.loading_=!1,this.toast("å®‰è£…æ’ä»¶å¤±è´¥: "+l,"error"),this.onLoadingDialogResult(2,l,-1)})},checkAlreadyInstalled(){var g;const l=new Set(this.extension_data.data.map(r=>{var h;return(h=r.repo)==null?void 0:h.toLowerCase()})),e=new Set(this.extension_data.data.map(r=>r.name));for(let r=0;r<this.pluginMarketData.length;r++){const h=this.pluginMarketData[r];h.installed=l.has((g=h.repo)==null?void 0:g.toLowerCase())||e.has(h.name)}let a=[],t=[];for(let r=0;r<this.pluginMarketData.length;r++)this.pluginMarketData[r].installed?a.push(this.pluginMarketData[r]):t.push(this.pluginMarketData[r]);this.pluginMarketData=t.concat(a)},openReadmeInNewTab(){this.readmeDialog.url&&window.open(this.readmeDialog.url,"_blank")},renderMarkdown(l){return l?(H.setOptions({highlight:function(e,a){if(a&&v.getLanguage(a))try{return v.highlight(e,{language:a}).value}catch(t){console.error(t)}return v.highlightAuto(e).value},gfm:!0,breaks:!0,headerIds:!0,mangle:!1}),H(l)):""}}},Be=Object.assign(Se,{setup(l){return(e,a)=>(i(),d(D,null,[s(_,null,{default:o(()=>[e.announcement?(i(),f(c,{key:0,cols:"12",md:"12"},{default:o(()=>[s(B,{color:"success",lines:"one",text:e.announcement,stacked:!1},null,8,["text"])]),_:1})):k("",!0),s(c,{cols:"12",md:"12"},{default:o(()=>[s(V,null,{default:o(()=>[s(x,null,{default:o(()=>[n("div",K,[O,s(m,{icon:"",size:"small",style:{"margin-left":"8px"},variant:"plain",onClick:a[0]||(a[0]=t=>e.jumpToPluginMarket())},{default:o(()=>[s(y,{size:"small"},{default:o(()=>[u("mdi-help")]),_:1}),s(G,{activator:"parent",location:"start"},{default:o(()=>[J]),_:1})]),_:1}),s(m,{icon:"",onClick:a[1]||(a[1]=t=>e.isListView=!e.isListView),size:"small",style:{"margin-left":"auto"},variant:"plain"},{default:o(()=>[s(y,null,{default:o(()=>[u(p(e.isListView?"mdi-view-grid":"mdi-view-list"),1)]),_:1})]),_:1}),s(C),s(R,{modelValue:e.marketSearch,"onUpdate:modelValue":a[2]||(a[2]=t=>e.marketSearch=t),density:"compact",label:"Search","prepend-inner-icon":"mdi-magnify",variant:"solo-filled",flat:"","hide-details":"","single-line":""},null,8,["modelValue"])])]),_:1}),s(M,null,{default:o(()=>[X,e.pinnedPlugins.length>0?(i(),d("div",Y,[Z,s(_,{style:{"margin-top":"8px"}},{default:o(()=>[(i(!0),d(D,null,E(e.pinnedPlugins,t=>(i(),f(c,{cols:"12",md:"6",lg:"6"},{default:o(()=>[s(L,{extension:t,"market-mode":"true",highlight:!0},null,8,["extension"])]),_:2},1024))),256))]),_:1})])):k("",!0),e.isListView?(i(),d("div",Q,[ee,s(c,{cols:"12",md:"12",style:{padding:"0px"}},{default:o(()=>[s(U,{headers:e.pluginMarketHeaders,items:e.pluginMarketData,"item-key":"name",loading:e.loading_,search:e.marketSearch,"onUpdate:search":a[3]||(a[3]=t=>e.marketSearch=t),"filter-keys":e.filterKeys},{"item.name":o(({item:t})=>[n("div",te,[t.logo?(i(),d("img",{key:0,src:t.logo,style:{height:"80px",width:"80px","margin-right":"8px","border-radius":"8px","margin-top":"8px","margin-bottom":"8px"},alt:"logo"},null,8,ae)):k("",!0),t!=null&&t.repo?(i(),d("span",le,[n("a",{href:t==null?void 0:t.repo,style:{color:"#000","text-decoration":"none"}},p(t.name),9,se)])):(i(),d("span",oe,p(t.name),1))])]),"item.desc":o(({item:t})=>[n("div",ne,p(t.desc),1)]),"item.author":o(({item:t})=>[n("div",ie,[t!=null&&t.social_link?(i(),d("span",re,[n("a",{href:t==null?void 0:t.social_link},p(t.author),9,de)])):(i(),d("span",ue,p(t.author),1))])]),"item.stars":o(({item:t})=>[n("a",{href:t.repo},[t.repo?(i(),d("img",{key:0,src:`https://img.shields.io/github/stars/${t.repo.split("/").slice(-2).join("/")}.svg`,alt:`Stars for ${t.name}`,style:{height:"20px"}},null,8,ge)):k("",!0)],8,he)]),"item.tags":o(({item:t})=>[t.tags.length===0?(i(),d("span",me,"æ— ")):k("",!0),(i(!0),d(D,null,E(t.tags,g=>(i(),f(F,{key:g,color:"primary",size:"x-small"},{default:o(()=>[u(p(g),1)]),_:2},1024))),128))]),"item.actions":o(({item:t})=>[t.installed?(i(),f(m,{key:1,class:"text-none mr-2",size:"x-small",variant:"flat",border:"",disabled:""},{default:o(()=>[u("å·²å®‰è£…")]),_:1})):(i(),f(m,{key:0,class:"text-none mr-2",size:"x-small",variant:"flat",border:"",onClick:g=>{e.extension_url=t.repo,e.newExtension()}},{default:o(()=>[u("å®‰è£…")]),_:2},1032,["onClick"])),s(m,{class:"text-none mr-2",size:"x-small",variant:"flat",border:"",onClick:g=>e.open(t.repo)},{default:o(()=>[u("å¸®åŠ©")]),_:2},1032,["onClick"])]),_:1},8,["headers","items","loading","search","filter-keys"])]),_:1})])):(i(),d("div",pe,[ce,s(_,{style:{"margin-top":"16px"}},{default:o(()=>[(i(!0),d(D,null,E(e.filteredPluginMarketData,t=>(i(),f(c,{cols:"12",md:"6",lg:"6"},{default:o(()=>[s(L,{extension:t,"market-mode":"true"},null,8,["extension"])]),_:2},1024))),256))]),_:1})]))]),_:1})]),_:1})]),_:1}),s(c,{style:{"margin-bottom":"16px"},cols:"12",md:"12"},{default:o(()=>[fe,u(" | "),_e]),_:1})]),_:1}),s(S,{modelValue:e.dialog,"onUpdate:modelValue":a[8]||(a[8]=t=>e.dialog=t),width:"700"},{activator:o(({props:t})=>[s(m,j(t,{icon:"mdi-plus",size:"x-large",style:{position:"fixed",right:"52px",bottom:"52px"},color:"darkprimary"}),null,16)]),default:o(()=>[s(V,null,{default:o(()=>[s(x,null,{default:o(()=>[ke]),_:1}),s(M,null,{default:o(()=>[s(N,null,{default:o(()=>[s(_,null,{default:o(()=>[ye,s(c,{cols:"12"},{default:o(()=>[we,s(R,{label:"ä»“åº“é“¾æŽ¥",modelValue:e.extension_url,"onUpdate:modelValue":a[4]||(a[4]=t=>e.extension_url=t),variant:"outlined",required:""},null,8,["modelValue"])]),_:1})]),_:1}),s(_,null,{default:o(()=>[De,s(c,{cols:"12"},{default:o(()=>[be,s(W,{label:"é€‰æ‹©æ–‡ä»¶",modelValue:e.upload_file,"onUpdate:modelValue":a[5]||(a[5]=t=>e.upload_file=t),accept:".zip",outlined:"",required:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),ve,n("small",null,p(e.status),1)]),_:1}),s(P,null,{default:o(()=>[s(C),s(m,{color:"blue-darken-1",variant:"text",onClick:a[6]||(a[6]=t=>e.dialog=!1)},{default:o(()=>[u(" å…³é—­ ")]),_:1}),s(m,{color:"blue-darken-1",variant:"text",loading:e.loading_,onClick:a[7]||(a[7]=t=>e.newExtension())},{default:o(()=>[u(" å®‰è£… ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(I,{timeout:2e3,elevation:"24",color:e.snack_success,modelValue:e.snack_show,"onUpdate:modelValue":a[9]||(a[9]=t=>e.snack_show=t)},{default:o(()=>[u(p(e.snack_message),1)]),_:1},8,["color","modelValue"]),s(z,{ref:"wfr"},null,512),s(S,{modelValue:e.readmeDialog.show,"onUpdate:modelValue":a[13]||(a[13]=t=>e.readmeDialog.show=t),width:"800",persistent:""},{default:o(()=>[s(V,null,{default:o(()=>[s(x,{class:"d-flex justify-space-between align-center"},{default:o(()=>[Ve,s(m,{icon:"",onClick:a[10]||(a[10]=t=>e.readmeDialog.show=!1)},{default:o(()=>[s(y,null,{default:o(()=>[u("mdi-close")]),_:1})]),_:1})]),_:1}),s($),s(M,{style:{height:"70vh","overflow-y":"auto"}},{default:o(()=>[s(m,{color:"primary","prepend-icon":"mdi-open-in-new",onClick:a[11]||(a[11]=t=>e.openReadmeInNewTab()),class:"mt-4"},{default:o(()=>[u(" åœ¨GitHubä¸­æŸ¥çœ‹æ–‡æ¡£ ")]),_:1}),e.readmeDialog.content?(i(),d("div",{key:0,class:"markdown-body",innerHTML:e.renderMarkdown(e.readmeDialog.content)},null,8,xe)):e.readmeDialog.error?(i(),d("div",Ce,[s(y,{size:"64",color:"error",class:"mb-4"},{default:o(()=>[u("mdi-alert-circle-outline")]),_:1}),n("p",Me,p(e.readmeDialog.error),1)])):(i(),d("div",Ee,[s(y,{size:"64",color:"warning",class:"mb-4"},{default:o(()=>[u("mdi-file-question-outline")]),_:1}),Le]))]),_:1}),s($),s(P,null,{default:o(()=>[s(C),s(m,{color:"primary",variant:"tonal",onClick:a[12]||(a[12]=t=>e.readmeDialog.show=!1)},{default:o(()=>[u(" å…³é—­ ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});export{Be as default};
