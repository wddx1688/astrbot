import{_ as g}from"./_plugin-vue_export-helper-c27b6911.js";import{o as r,c as h,w as a,b as s,q as e,f as v,t as l,V,e as u,g as k,H as S,E as T,a5 as y,a6 as $,l as R,a7 as p,a8 as E,a1 as D,m as w,a9 as j,T as C,n as G,F as x,p as z,j as Y,h as q,L as W,aa as f,X as I,v as X,Z,Y as b}from"./index-809c946b.js";const J={name:"TotalMessage",props:["stat"],computed:{formattedCount(){var o;const t=(o=this.stat)==null?void 0:o.message_count;return t?t.toLocaleString():"0"}}},N=t=>(y("data-v-31a04cc5"),t=t(),$(),t),K={class:"d-flex align-start"},Q={class:"icon-wrapper"},tt={class:"stat-content"},et=N(()=>e("div",{class:"stat-title"},"消息总数",-1)),st={class:"stat-value-wrapper"},at={class:"stat-value"},ot=N(()=>e("div",{class:"stat-subtitle"},"所有平台发送的消息总计",-1));function lt(t,o,c,_,m,i){return r(),h(T,{elevation:"1",class:"stat-card message-card"},{default:a(()=>[s(S,null,{default:a(()=>[e("div",K,[e("div",Q,[s(v,{icon:"mdi-message-text-outline",size:"24"})]),e("div",tt,[et,e("div",st,[e("h2",at,l(i.formattedCount),1),c.stat.daily_increase?(r(),h(V,{key:0,class:"trend-chip",size:"x-small",color:"success"},{default:a(()=>[u(" +"+l(c.stat.daily_increase),1)]),_:1})):k("",!0)]),ot])])]),_:1})]),_:1})}const it=g(J,[["render",lt],["__scopeId","data-v-31a04cc5"]]);const nt={name:"OnlinePlatform",props:["stat"]},U=t=>(y("data-v-27201b03"),t=t(),$(),t),rt={class:"d-flex align-start"},ct={class:"icon-wrapper"},dt={class:"stat-content"},_t=U(()=>e("div",{class:"stat-title"},"消息平台",-1)),mt={class:"stat-value-wrapper"},ht={class:"stat-value"},ut=U(()=>e("div",{class:"stat-subtitle"},"已连接的消息平台数量",-1));function ft(t,o,c,_,m,i){return r(),h(T,{elevation:"1",class:"stat-card platform-card"},{default:a(()=>[s(S,null,{default:a(()=>[e("div",rt,[e("div",ct,[s(v,{icon:"mdi-server-network",size:"24"})]),e("div",dt,[_t,e("div",mt,[e("h2",ht,l(c.stat.platform_count||0),1)]),ut])])]),_:1})]),_:1})}const pt=g(nt,[["render",ft],["__scopeId","data-v-27201b03"]]);const vt={name:"RunningTime",props:["stat"],computed:{formattedTime(){var t;return((t=this.stat)==null?void 0:t.running)||"加载中..."}}},L=t=>(y("data-v-6866fe54"),t=t(),$(),t),gt={class:"d-flex align-start"},yt={class:"icon-wrapper"},$t={class:"stat-content"},bt=L(()=>e("div",{class:"stat-title"},"运行时间",-1)),wt={class:"stat-value-wrapper"},St={class:"stat-value"},Tt=L(()=>e("div",{class:"stat-subtitle"},"AstrBot 运行时间",-1));function Mt(t,o,c,_,m,i){return r(),h(T,{elevation:"1",class:"stat-card uptime-card"},{default:a(()=>[s(S,null,{default:a(()=>[e("div",gt,[e("div",yt,[s(v,{icon:"mdi-clock-outline",size:"24"})]),e("div",$t,[bt,e("div",wt,[e("h2",St,l(i.formattedTime),1)]),Tt])])]),_:1})]),_:1})}const Pt=g(vt,[["render",Mt],["__scopeId","data-v-6866fe54"]]);const Ct={name:"MemoryUsage",props:["stat"],computed:{memoryPercentage(){return!this.stat.memory||!this.stat.memory.process||!this.stat.memory.system?0:Math.round(this.stat.memory.process/this.stat.memory.system*100)},memoryStatus(){const t=this.memoryPercentage;return t<30?{color:"success",label:"良好"}:t<70?{color:"warning",label:"正常"}:{color:"error",label:"偏高"}}}},B=t=>(y("data-v-0397ad9f"),t=t(),$(),t),It={class:"d-flex align-start"},Rt={class:"icon-wrapper"},Vt={class:"stat-content"},kt=B(()=>e("div",{class:"stat-title"},"内存占用",-1)),xt={class:"stat-value-wrapper"},zt={class:"stat-value"},Dt={class:"memory-unit"},Nt={class:"metrics-container"},Ut={class:"metric-item"},Lt=B(()=>e("div",{class:"metric-label"},"CPU 负载",-1)),Bt={class:"metric-value"};function At(t,o,c,_,m,i){return r(),h(T,{elevation:"1",class:"stat-card memory-card"},{default:a(()=>[s(S,null,{default:a(()=>{var d,n;return[e("div",It,[e("div",Rt,[s(v,{icon:"mdi-memory",size:"24"})]),e("div",Vt,[kt,e("div",xt,[e("h2",zt,[u(l(((d=c.stat.memory)==null?void 0:d.process)||0)+" ",1),e("span",Dt,"MiB / "+l(((n=c.stat.memory)==null?void 0:n.system)||0)+" MiB",1)]),s(V,{color:i.memoryStatus.color,size:"x-small",class:"status-chip"},{default:a(()=>[u(l(i.memoryStatus.label),1)]),_:1},8,["color"])])])]),e("div",Nt,[e("div",Ut,[Lt,e("div",Bt,l(c.stat.cpu_percent||"0")+"%",1)])])]}),_:1})]),_:1})}const Ot=g(Ct,[["render",At],["__scopeId","data-v-0397ad9f"]]);const Ht={name:"MessageStat",props:["stat"],data:()=>({totalMessages:"0",dailyAverage:"0",growthRate:0,loading:!1,selectedTimeRange:{label:"过去 1 天",value:86400},timeRanges:[{label:"过去 1 天",value:86400},{label:"过去 3 天",value:259200},{label:"过去 7 天",value:604800},{label:"过去 30 天",value:2592e3}],chartOptions:{chart:{type:"area",height:400,fontFamily:"inherit",foreColor:"#a1aab2",toolbar:{show:!0,tools:{download:!0,selection:!1,zoom:!0,zoomin:!0,zoomout:!0,pan:!0}},animations:{enabled:!0,easing:"easeinout",speed:800}},colors:["#5e35b1"],fill:{type:"solid",opacity:.3},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},markers:{size:3,strokeWidth:2,hover:{size:5}},tooltip:{theme:"light",x:{format:"yyyy-MM-dd HH:mm"},y:{title:{formatter:()=>"消息条数 "}}},xaxis:{type:"datetime",title:{text:"时间"},labels:{formatter:function(t){return new Date(t).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}},tooltip:{enabled:!1}},yaxis:{title:{text:"消息条数"},min:function(t){return t<10?0:Math.floor(t*.8)}},grid:{borderColor:"#f1f1f1",row:{colors:["transparent","transparent"],opacity:.2},column:{colors:["transparent","transparent"]},padding:{left:0,right:0}}},chartSeries:[{name:"消息条数",data:[]}],messageTimeSeries:[]}),mounted(){this.fetchMessageSeries()},methods:{formatNumber(t){return new Intl.NumberFormat("zh-CN").format(t)},async fetchMessageSeries(){this.loading=!0;try{const o=(await R.get(`/api/stat/get?offset_sec=${this.selectedTimeRange.value}`)).data.data;o&&o.message_time_series&&(this.messageTimeSeries=o.message_time_series,this.processTimeSeriesData())}catch(t){console.error("获取消息趋势数据失败:",t)}finally{this.loading=!1}},processTimeSeriesData(){this.chartSeries[0].data=this.messageTimeSeries.map(o=>[new Date(o[0]*1e3).getTime(),o[1]]);let t=0;if(this.messageTimeSeries.forEach(o=>{t+=o[1]}),this.totalMessages=this.formatNumber(t),this.messageTimeSeries.length>0){const o=this.selectedTimeRange.value/86400;this.dailyAverage=this.formatNumber(Math.round(t/o))}this.calculateGrowthRate()},calculateGrowthRate(){if(this.messageTimeSeries.length<4){this.growthRate=0;return}const t=Math.floor(this.messageTimeSeries.length/2),o=this.messageTimeSeries.slice(0,t).reduce((_,m)=>_+m[1],0),c=this.messageTimeSeries.slice(t).reduce((_,m)=>_+m[1],0);o>0?this.growthRate=Math.round((c-o)/o*100):this.growthRate=c>0?100:0}}},P=t=>(y("data-v-65c0ef93"),t=t(),$(),t),Ft={class:"chart-header"},Et=P(()=>e("div",null,[e("div",{class:"chart-title"},"消息趋势分析"),e("div",{class:"chart-subtitle"},"跟踪消息数量随时间的变化")],-1)),jt={class:"d-flex align-center"},Gt={class:"chart-stats"},Yt={class:"stat-box"},qt=P(()=>e("div",{class:"stat-label"},"总消息数",-1)),Wt={class:"stat-number"},Xt={class:"stat-box"},Zt=P(()=>e("div",{class:"stat-label"},"平均每天",-1)),Jt={class:"stat-number"},Kt=P(()=>e("div",{class:"stat-label"},"增长率",-1)),Qt={class:"stat-number"},te={class:"chart-container"},ee={key:0,class:"loading-overlay"},se=P(()=>e("div",{class:"loading-text"},"加载中...",-1));function ae(t,o,c,_,m,i){const d=p("apexchart");return r(),h(T,{elevation:"1",class:"chart-card"},{default:a(()=>[s(S,null,{default:a(()=>[e("div",Ft,[Et,s(E,{color:"primary",variant:"outlined",density:"compact","hide-details":"",modelValue:t.selectedTimeRange,"onUpdate:modelValue":[o[0]||(o[0]=n=>t.selectedTimeRange=n),i.fetchMessageSeries],items:t.timeRanges,"item-title":"label","item-value":"value",class:"time-select","return-object":"","single-line":""},{selection:a(({item:n})=>[e("div",jt,[s(v,{start:"",size:"small"},{default:a(()=>[u("mdi-calendar-range")]),_:1}),u(" "+l(n.raw.label),1)])]),_:1},8,["modelValue","items","onUpdate:modelValue"])]),e("div",Gt,[e("div",Yt,[qt,e("div",Wt,l(t.totalMessages),1)]),e("div",Xt,[Zt,e("div",Jt,l(t.dailyAverage),1)]),e("div",{class:D(["stat-box",{"trend-up":t.growthRate>0,"trend-down":t.growthRate<0}])},[Kt,e("div",Qt,[s(v,{size:"small",icon:t.growthRate>0?"mdi-arrow-up":"mdi-arrow-down"},null,8,["icon"]),u(" "+l(Math.abs(t.growthRate))+"% ",1)])],2)]),e("div",te,[t.loading?(r(),w("div",ee,[s(j,{indeterminate:"",color:"primary"}),se])):k("",!0),s(d,{type:"area",height:"280",options:t.chartOptions,series:t.chartSeries,ref:"chart"},null,8,["options","series"])])]),_:1})]),_:1})}const oe=g(Ht,[["render",ae],["__scopeId","data-v-65c0ef93"]]);const le={name:"PlatformStat",props:["stat"],data:()=>({platforms:[]}),computed:{sortedPlatforms(){return[...this.platforms].sort((t,o)=>o.count-t.count)},totalCount(){return this.platforms.reduce((t,o)=>t+o.count,0)},mostActivePlatform(){return this.sortedPlatforms.length>0?this.sortedPlatforms[0].name:"-"},topPlatformPercentage(){return this.totalCount===0||this.sortedPlatforms.length===0?0:Math.round(this.sortedPlatforms[0].count/this.totalCount*100)}},watch:{stat:{handler:function(t){t&&t.platform&&(this.platforms=t.platform)},deep:!0}},methods:{getPercentage(t){return this.totalCount?t/this.totalCount*100:0}}},M=t=>(y("data-v-03c24873"),t=t(),$(),t),ie=M(()=>e("div",{class:"platform-header"},[e("div",null,[e("div",{class:"platform-title"},"平台消息统计"),e("div",{class:"platform-subtitle"},"各平台消息数量分布")])],-1)),ne={key:0,class:"platform-list-container"},re={class:"platform-count"},ce={class:"count-value"},de=M(()=>e("span",{class:"count-label"},"条",-1)),_e={class:"platform-stats-summary"},me={class:"platform-stat-item"},he=M(()=>e("div",{class:"stat-label"},"平台数",-1)),ue={class:"stat-value"},fe={class:"platform-stat-item"},pe=M(()=>e("div",{class:"stat-label"},"最活跃",-1)),ve={class:"stat-value"},ge={class:"platform-stat-item"},ye=M(()=>e("div",{class:"stat-label"},"总消息占比",-1)),$e={class:"stat-value"},be={class:"platform-chart"},we={key:1,class:"no-data"},Se=M(()=>e("div",{class:"no-data-text"},"暂无平台数据",-1));function Te(t,o,c,_,m,i){return r(),h(T,{elevation:"1",class:"platform-stat-card"},{default:a(()=>[s(S,null,{default:a(()=>[ie,s(C,{class:"my-3"}),t.platforms.length>0?(r(),w("div",ne,[s(G,{class:"platform-list",density:"compact"},{default:a(()=>[(r(!0),w(x,null,z(i.sortedPlatforms,(d,n)=>(r(),h(Y,{key:n,value:d,class:"platform-item"},{prepend:a(()=>[e("div",{class:D(["platform-rank",{"top-rank":n<3}])},l(n+1),3)]),append:a(()=>[e("div",re,[e("span",ce,l(d.count),1),de])]),default:a(()=>[s(q,{class:"platform-name"},{default:a(()=>[u(l(d.name),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),e("div",_e,[e("div",me,[he,e("div",ue,l(t.platforms.length),1)]),s(C,{vertical:""}),e("div",fe,[pe,e("div",ve,l(i.mostActivePlatform),1)]),s(C,{vertical:""}),e("div",ge,[ye,e("div",$e,l(i.topPlatformPercentage)+"%",1)])]),e("div",be,[(r(!0),w(x,null,z(i.sortedPlatforms.slice(0,5),(d,n)=>(r(),h(W,{key:n,"model-value":i.getPercentage(d.count),height:"8",rounded:"",class:"platform-progress",color:n===0?"primary":n===1?"info":n===2?"success":"grey-lighten-1"},null,8,["model-value","color"]))),128))])])):(r(),w("div",we,[s(v,{icon:"mdi-information-outline",size:"40",color:"grey-lighten-1"}),Se]))]),_:1})]),_:1})}const Me=g(le,[["render",Te],["__scopeId","data-v-03c24873"]]);const Pe={name:"DefaultDashboard",components:{TotalMessage:it,OnlinePlatform:pt,RunningTime:Pt,MemoryUsage:Ot,MessageStat:oe,PlatformStat:Me},data:()=>({stat:{},noticeTitle:"",noticeContent:"",noticeType:"",lastUpdated:"加载中...",refreshInterval:null,isRefreshing:!1}),mounted(){this.fetchData(),this.fetchNotice(),this.refreshInterval=setInterval(()=>{this.fetchData()},6e4)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{async fetchData(){this.isRefreshing=!0;try{const t=await R.get("/api/stat/get");this.stat=t.data.data,this.lastUpdated=new Date().toLocaleTimeString(),console.log("Dashboard data:",this.stat)}catch(t){console.error("获取数据失败:",t)}finally{this.isRefreshing=!1}},fetchNotice(){R.get("https://api.soulter.top/astrbot-announcement").then(t=>{let o=t.data.data;o["dashboard-notice"]&&(this.noticeTitle=o["dashboard-notice"].title,this.noticeContent=o["dashboard-notice"].content,this.noticeType=o["dashboard-notice"].type)}).catch(t=>{console.error("获取公告失败:",t)})}}},Ce=t=>(y("data-v-f394038b"),t=t(),$(),t),Ie={class:"dashboard-container"},Re=Ce(()=>e("div",{class:"dashboard-header"},[e("h1",{class:"dashboard-title"},"控制台"),e("div",{class:"dashboard-subtitle"},"实时监控和统计数据")],-1)),Ve={class:"dashboard-footer"};function ke(t,o,c,_,m,i){const d=p("TotalMessage"),n=p("OnlinePlatform"),A=p("RunningTime"),O=p("MemoryUsage"),H=p("MessageStat"),F=p("PlatformStat");return r(),w("div",Ie,[Re,s(f,null,{default:a(()=>[t.noticeTitle&&t.noticeContent?(r(),h(I,{key:0,class:"notice-row"},{default:a(()=>[s(Z,{type:t.noticeType,text:t.noticeContent,title:t.noticeTitle,closable:"",class:"dashboard-alert",variant:"tonal",border:"start"},null,8,["type","text","title"])]),_:1})):k("",!0)]),_:1}),s(I,{class:"stats-row"},{default:a(()=>[s(b,{cols:"12",md:"3"},{default:a(()=>[s(f,null,{default:a(()=>[s(d,{stat:t.stat},null,8,["stat"])]),_:1})]),_:1}),s(b,{cols:"12",md:"3"},{default:a(()=>[s(f,null,{default:a(()=>[s(n,{stat:t.stat},null,8,["stat"])]),_:1})]),_:1}),s(b,{cols:"12",md:"3"},{default:a(()=>[s(f,null,{default:a(()=>[s(A,{stat:t.stat},null,8,["stat"])]),_:1})]),_:1}),s(b,{cols:"12",md:"3"},{default:a(()=>[s(f,null,{default:a(()=>[s(O,{stat:t.stat},null,8,["stat"])]),_:1})]),_:1})]),_:1}),s(I,{class:"charts-row"},{default:a(()=>[s(b,{cols:"12",lg:"8"},{default:a(()=>[s(f,null,{default:a(()=>[s(H)]),_:1})]),_:1}),s(b,{cols:"12",lg:"4"},{default:a(()=>[s(f,null,{default:a(()=>[s(F,{stat:t.stat},null,8,["stat"])]),_:1})]),_:1})]),_:1}),e("div",Ve,[s(V,{size:"small",color:"primary",variant:"flat","prepend-icon":"mdi-refresh"},{default:a(()=>[u(" 最后更新: "+l(t.lastUpdated),1)]),_:1}),s(X,{icon:"mdi-refresh",size:"small",color:"primary",variant:"text",class:"ml-2",onClick:i.fetchData,loading:t.isRefreshing},null,8,["onClick","loading"])])])}const De=g(Pe,[["render",ke],["__scopeId","data-v-f394038b"]]);export{De as default};
